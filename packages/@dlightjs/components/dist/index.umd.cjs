(function(h,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("@dlightjs/dlight")):typeof define=="function"&&define.amd?define(["exports","@dlightjs/dlight"],d):(h=typeof globalThis<"u"?globalThis:h||self,d(h.component={},h._$))})(this,function(h,d){"use strict";var F=Object.defineProperty;var H=(h,d,u)=>d in h?F(h,d,{enumerable:!0,configurable:!0,writable:!0,value:u}):h[d]=u;var t=(h,d,u)=>(H(h,typeof d!="symbol"?d+"":d,u),u);function u(s){const a=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const e in s)if(e!=="default"){const r=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(a,e,r.get?r:{enumerable:!0,get:()=>s[e]})}}return a.default=s,Object.freeze(a)}const l=u(d);class T extends d.View{constructor(){super(...arguments);t(this,"_$tag","Spacer");t(this,"Body",()=>[new l.HtmlNode("div")])}}function m(s){if(![d.DLNodeType.HTML,d.DLNodeType.Text].includes(s._$nodeType)){if(s._$tag==="Spacer")return!0;for(let a of s._$nodes??[])if(m(a))return!0}return!1}class U extends d.View{constructor(){super(...arguments);t(this,"_$derivedPairs",{margin:["alignment"]});t(this,"_$deps",{spacing:new Map,alignment:new Map,width:new Map,height:new Map,margin:new Map});t(this,"_$tag","HStack");t(this,"_$$spacing","_$prop");t(this,"spacing",10);t(this,"_$$alignment","_$prop");t(this,"alignment","top");t(this,"_$$width","_$prop");t(this,"width","100%");t(this,"_$$height","_$prop");t(this,"height","max-content");t(this,"margin",()=>function(){switch(this.alignment){case"top":return"0 0 auto 0";case"bottom":return"auto 0 0 0";case"center":return"auto 0";default:return""}}.call(this));t(this,"Body",()=>{const e=new l.HtmlNode("div");return e._$addProp("_height",()=>this.height,this,["height"]),e._$addProp("_width",()=>this.width,this,["width"]),e._$addProp("_columnGap",()=>`${this.spacing}px`,this,["spacing"]),e._$addProp("_display","flex"),e._$addProp("_flexDirection","row"),e._$addNodes((()=>{const r=new l.ForNode;return r._$addNodess(Array.from(this._$children).map(n=>(()=>{const o=new l.IfNode;return o._$addCond(()=>m(n),()=>{const i=new l.ExpressionNode(n);return i._$addProp("_flexGrow",1),[i]}),o._$addCond(()=>!0,()=>{const i=new l.ExpressionNode(n);return i._$addProp("_flexShrink",0),i._$addProp("_margin",()=>this.margin,this,["margin"],!0),[i]}),[o]})())),[r]})()),[e]})}}class A extends d.View{constructor(){super(...arguments);t(this,"_$derivedPairs",{margin:["alignment"]});t(this,"_$deps",{spacing:new Map,alignment:new Map,width:new Map,height:new Map,margin:new Map});t(this,"_$tag","VStack");t(this,"_$$spacing","_$prop");t(this,"spacing",10);t(this,"_$$alignment","_$prop");t(this,"alignment","top");t(this,"_$$width","_$prop");t(this,"width","max-content");t(this,"_$$height","_$prop");t(this,"height","100%");t(this,"margin",()=>function(){switch(this.alignment){case"top":return"0 auto 0 0";case"bottom":return"0 0 0 auto";case"center":return"0 auto";default:return""}}.call(this));t(this,"Body",()=>{const e=new l.HtmlNode("div");return e._$addProp("_height",()=>this.height,this,["height"]),e._$addProp("_width",()=>this.width,this,["width"]),e._$addProp("_columnGap",()=>`${this.spacing}px`,this,["spacing"]),e._$addProp("_display","flex"),e._$addProp("_flexDirection","column"),e._$addNodes((()=>{const r=new l.ForNode;return r._$addNodess(Array.from(this._$children).map(n=>(()=>{const o=new l.IfNode;return o._$addCond(()=>m(n),()=>{const i=new l.ExpressionNode(n);return i._$addProp("_flexGrow",1),[i]}),o._$addCond(()=>!0,()=>{const i=new l.ExpressionNode(n);return i._$addProp("_flexShrink",0),i._$addProp("_margin",()=>this.margin,this,["margin"],!0),[i]}),[o]})())),[r]})()),[e]})}}class b extends d.View{constructor(){super(...arguments);t(this,"_$deps",{hAlignment:new Map,vAlignment:new Map,width:new Map,height:new Map});t(this,"_$tag","ZStack");t(this,"_$$hAlignment","_$prop");t(this,"hAlignment","center");t(this,"_$$vAlignment","_$prop");t(this,"vAlignment","center");t(this,"_$$width","_$prop");t(this,"width","max-content");t(this,"_$$height","_$prop");t(this,"height","max-content");t(this,"Body",()=>{const e=new l.HtmlNode("div");return e._$addProp("_height",()=>this.height,this,["height"]),e._$addProp("_width",()=>this.width,this,["width"]),e._$addProp("_columnGap",`${this.spacing}px`),e._$addProp("_display","grid"),e._$addProp("_alignItems",()=>({top:"flex-start",center:"center",bottom:"flex-end"})[this.vAlignment],this,["vAlignment"]),e._$addProp("_justifyItems",()=>({leading:"left",center:"center",tailing:"right"})[this.hAlignment],this,["hAlignment"]),e._$addNodes((()=>{const r=new l.ForNode;return r._$addNodess(Array.from(this._$children).map(n=>(()=>{const o=new l.ExpressionNode(n);return o._$addProp("_position","relative"),o._$addProp("_gridArea","1 / 1/ 1 / 1"),[o]})())),[r]})()),[e]})}}function N(){return location.hash.slice(2)}function x(){return location.pathname.slice(1)}function S(s,a){let e;if(s[0]==="/")e=s;else{s[0]!=="."&&(s="./"+s);const r=s.split("/"),n=a.split("/").filter(i=>i);let o=0;for(let i of r){if(![".",".."].includes(i))break;i===".."&&(n.length===0&&console.warn(`no ../ in ${s}`),n.pop()),o++}e="/"+[...n,...r.slice(o)].join("/")}return e}class E{constructor(){t(this,"mode","hash");t(this,"baseUrl","")}hashTo(a){window.location.href="#"+S(a,this.baseUrl)}historyTo(a){window.history.pushState({},"",S(a,this.baseUrl))}to(a){if(this.mode==="hash"){this.hashTo(a);return}this.historyTo(a)}}class L extends d.View{constructor(){super(...arguments);t(this,"_$deps",{_$content:new Map});t(this,"_$tag","Route");t(this,"_$$_$content","_$prop");t(this,"_$content"," none");t(this,"Body",()=>[new l.ExpressionNode(this._$children)])}}const v=history.pushState;let $=[];class C extends d.View{constructor(){super(...arguments);t(this,"_$derivedPairs",{currUrl:["mode"],showedRoute:["currUrl"]});t(this,"_$deps",{mode:new Map,navigator:new Map,currUrl:new Map,showedRoute:new Map});t(this,"_$tag","RouterSpace");t(this,"_$$mode","_$prop");t(this,"mode","history");t(this,"_$$navigator");t(this,"_$$currUrl",()=>this.mode==="hash"?N():x());t(this,"baseUrl","");t(this,"prevPathCondition","");t(this,"prevRoutes",[]);t(this,"showedRoute",()=>function(){const e=this.prevPathCondition;this.prevPathCondition="";const r=this.currUrl.replace(new RegExp(`^${this.baseUrl}`),"");let n=[];for(let o of this._$childrenFunc){const i=o();if(i._$tag!=="Route"){n.push(i);continue}let p=i._$content,c=!1;if(typeof i._$content=="string"){p=p.replace(/^(\.\/)+/,"");const _=p==="."&&r==="",f=(r+"/").startsWith(p+"/");c=_||f||p===" none"}else p instanceof RegExp&&(c=p.test(r));if(c){if(p===e)return this.prevPathCondition=e,this.prevRoutes;n.push(i),this.prevPathCondition=p;break}}return this.prevRoutes=n,n}.call(this));t(this,"historyChangeListen",()=>{this.currUrl=x()});t(this,"hashChangeListen",()=>{this.currUrl=N()});t(this,"Body",()=>{const e=new l.EnvNode;return e._$addNodes((()=>[new l.ExpressionNode(()=>this.showedRoute,this,["showedRoute"])])()),e._$addProp("RouteParam",()=>({path:this.currUrl,navigator:this.navigator}),this,["currUrl","navigator"],!1),[e]})}get navigator(){return this._$$navigator}set navigator(e){this._$$navigator!==e&&(this._$$navigator=e,this._$runDeps("navigator"))}get currUrl(){return this._$$currUrl}set currUrl(e){this._$$currUrl!==e&&(this._$$currUrl=e,this._$runDeps("currUrl"))}didMount(){if(this.mode==="hash"){addEventListener("load",this.hashChangeListen),addEventListener("hashchange",this.hashChangeListen);return}addEventListener("load",this.historyChangeListen),addEventListener("popstate",this.historyChangeListen),$.push(this.historyChangeListen),history.pushState=new Proxy(v,{apply:(e,r,n)=>{const o=e.apply(r,n);for(let i of $)i();return o}})}willUnmount(){if(this.mode==="hash"){removeEventListener("load",this.hashChangeListen),removeEventListener("hashchange",this.hashChangeListen);return}removeEventListener("load",this.historyChangeListen),removeEventListener("popstate",this.historyChangeListen),$=$.filter(e=>e!==this.historyChangeListen),$.length>0?history.pushState=new Proxy(v,{apply:(e,r,n)=>{const o=e.apply(r,n);for(let i of $)i();return o}}):history.pushState=v}AfterConstruct(){let e=this._$parentNode;for(;e;)e._$tag==="Route"&&(this.baseUrl=e._$content+"/"+this.baseUrl),e=e._$parentNode}Preset(){const e=new E;e.mode=this.mode,e.baseUrl=this.baseUrl,this.navigator=e}}class D extends d.View{constructor(){super(...arguments);t(this,"_$deps",{duration:new Map,easing:new Map,delay:new Map,appearWith:new Map,disappearWith:new Map,movable:new Map});t(this,"_$tag","Transition");t(this,"_$duration",.5);t(this,"_$easing","ease-in-out");t(this,"_$delay",0);t(this,"_$$duration","_$prop");t(this,"duration",this._$duration);t(this,"_$$easing","_$prop");t(this,"easing",this._$easing);t(this,"_$$delay","_$prop");t(this,"delay",this._$delay);t(this,"_duration",e=>this.parseProp(e,"duration"));t(this,"_easing",e=>this.parseProp(e,"easing"));t(this,"_delay",e=>this.parseProp(e,"delay"));t(this,"firstRender",!0);t(this,"transition",(e,r)=>`all ${this._duration(e)[r]}s ${this._easing(e)[r]} ${this._delay(e)[r]}s`);t(this,"_$$appearWith","_$prop");t(this,"appearWith",{opacity:0});t(this,"_$$disappearWith","_$prop");t(this,"disappearWith",{opacity:0});t(this,"_$$movable","_$prop");t(this,"movable",!0);t(this,"prevElInfos",new Map);t(this,"removeStore");t(this,"lastDisappear",!1);t(this,"removeStores");t(this,"Body",()=>{const e=new l.ExpressionNode(this._$children);return e._$onUpdateNodes(()=>{for(let[r,n]of this.prevElInfos.entries())if(this.movable){r.style.transform="";const o={rect:r.getBoundingClientRect(),stopTrigger:n.stopTrigger};if(this.prevElInfos.set(r,o),o.stopTrigger)continue;n.stopTrigger=!0;const i=n.rect.x-o.rect.x,p=n.rect.y-o.rect.y;k(r,this._duration(r).move,this._easing(r).move,this._delay(r).move,i,p,o)}}),e._$addProp("didAppear",r=>{if(r.style.transition=this.firstRender?this.transition(r,"firstAppear"):this.transition(r,"appear"),w(r,i=>{i.style.transition=this.firstRender?this.transition(i,"firstAppear"):this.transition(i,"appear")}),requestAnimationFrame(()=>{this.prevElInfos.set(r,{rect:r.getBoundingClientRect(),stopTrigger:!0})}),!this.appearWith)return;const n=r.style.cssText;R(r,this.appearWith);const o=this.firstRender;requestAnimationFrame(()=>{r.setAttribute("style",n);const i=()=>{const p=this.prevElInfos.get(r);p.rect=r.getBoundingClientRect(),p.stopTrigger=!1,r.removeEventListener("transitionend",i)};r.addEventListener("transitionend",i),this.firstRender&&(this.firstRender=!1),setTimeout(()=>{this.prevElInfos.get(r).stopTrigger=!1},this._duration(r).appear*1e3),o&&requestAnimationFrame(()=>{r.style.transition=this.transition(r,"appear")})})}),e._$addProp("willDisappear",r=>{this.lastDisappear||(this.removeStore=M(r),this.prevElInfos.delete(r))}),e._$addProp("didDisappear",()=>{this.lastDisappear||this.resolveDisappear(this.removeStore)}),[e]})}parseProp(e,r){let n={};const o=this["_$"+r],i=this[r];typeof i=="object"?(n.appear=i.appear??o,n.firstAppear=i.firstAppear??n.appear,n.disappear=i.disappear??o,n.lastDisappear=i.lastDisappear??n.disappear,n.move=i.move??o):(n.firstAppear=i,n.appear=i,n.disappear=i,n.lastDisappear=i,n.move=i);const p=c=>typeof c=="function"?c(e):c;return n.appear=p(n.appear)??o,n.firstAppear=p(n.firstAppear)??n.appear,n.disappear=p(n.disappear)??o,n.lastDisappear=p(n.lastDisappear)??n.disappear,n.move=p(n.move)??o,n}resolveDisappear(e){const{el:r,parentNode:n,rect:o,idx:i}=e;r.style.position="absolute",r.style.transition=this.lastDisappear?this.transition(r,"lastDisappear"):this.transition(r,"disappear"),r.style.margin="",r.style.transform="",w(r,p=>{p.style.margin="",p.style.transform=""}),r.style.top=`${o.top}px`,r.style.left=`${o.left}px`,n.childNodes.length>=i?n.appendChild(r):n.insertBefore(r,n.childNodes[i]),requestAnimationFrame(()=>{const p=()=>{r.removeEventListener("transitionend",p),r.remove()};r.addEventListener("transitionend",p),R(r,this.disappearWith)})}willUnmount(){this.lastDisappear=!0;const e=this._$el;this.removeStores=[];for(let r of e)this.removeStores.push(M(r))}didUnmount(){for(let e of this.removeStores)this.resolveDisappear(e)}}function M(s){var a;return{el:s.cloneNode(!0),parentNode:s.parentNode,rect:{top:s.offsetTop,left:s.offsetLeft},idx:Array.from(((a=s.parentNode)==null?void 0:a.childNodes)??[]).indexOf(s)}}function w(s,a){s.nodeType!==Node.TEXT_NODE&&(a(s),s.childNodes.forEach(e=>w(e,a)))}function R(s,a){typeof a=="function"&&(a=a(s));const e=s.style.cssText;if(typeof a=="string")s.setAttribute("style",e+a);else for(let[r,n]of Object.entries(a))s.style[r]=n}function k(s,a,e,r,n,o,i){let p,c,_=!1;const f=`all ${a}s ${e} ${r}s`;function y(g){p===void 0&&(p=g,s.style.transition=f+", transform 0s");const I=g-p;if(c!==g){const P=Math.max(I/(a*1e3)-r,0),j=P*n,B=P*o;P>=1?(s.style.transform="",_=!0):s.style.transform=`translate(${n-j}px, ${o-B}px)`,i.rect=s.getBoundingClientRect()}c=g,!_&&!i.stopTrigger?requestAnimationFrame(y):s.style.transition=f}requestAnimationFrame(y)}h.HStack=U,h.Navigator=E,h.Route=L,h.RouterSpace=C,h.Spacer=T,h.Transition=D,h.VStack=A,h.ZStack=b,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
