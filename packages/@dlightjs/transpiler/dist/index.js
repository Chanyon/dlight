"use strict";var $e=Object.create;var F=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var ke=Object.getPrototypeOf,xe=Object.prototype.hasOwnProperty;var Se=(n,e)=>{for(var s in e)F(n,s,{get:e[s],enumerable:!0})},O=(n,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ve(e))!xe.call(n,r)&&r!==s&&F(n,r,{get:()=>e[r],enumerable:!(t=be(e,r))||t.enumerable});return n};var y=(n,e,s)=>(s=n!=null?$e(ke(n)):{},O(e||!n||!n.__esModule?F(s,"default",{value:n,enumerable:!0}):s,n)),Ne=n=>O(F({},"__esModule",{value:!0}),n);var Ae={};Se(Ae,{JSDConfig:()=>ge,JSXConfig:()=>ce,geneParserNode:()=>De});module.exports=Ne(Ae);var C=y(require("@babel/types"));function V(n,e,s){return[C.classMethod("get",C.identifier(n),[],e),C.classMethod("set",C.identifier(n),[C.identifier("value")],s)]}function R(n){let e=n.value;n.value={type:"ArrowFunctionExpression",params:[],body:e}}var c=y(require("@babel/types"));function W(n,e,s,t){t.body.includes(s)||t.body.unshift(s),s.value.properties.push(c.objectProperty(c.identifier(n),c.arrayExpression(e.map(r=>c.stringLiteral(r)))))}function D(n,e,s){s.body.includes(e)||s.body.unshift(e),!e.value.properties.map(t=>t.key.name).includes(n)&&e.value.properties.push(c.objectProperty(c.identifier(n),c.newExpression(c.identifier("Map"),[])))}function M(n,e){let s=!1,t=n.parentPath;for(;t&&t.node!==e;){if(c.isArrowFunctionExpression(t.node)){s=!0;break}t=t.parentPath}return s}function we(n){let e=n.parentPath.node;return c.isAssignmentExpression(e)&&e.left===n.node}function Ce(n,e){let s=n.node,t=!1,r=n.parentPath;for(;r&&r.node!==e;){if(c.isAssignmentExpression(r.node)){let i=r.node.left,o=s.type===i.type,a=s.property.name===i.property.name;t=o&&a}r=r.parentPath}return t}function A(n,e){return!M(n,e)&&!we(n)&&!Ce(n,e)}var E=y(require("@babel/types"));var G=y(require("@babel/core")),Pe=G.parse;function J(n){return Pe(n).program.body[0]}function U(n,e){let s=n.key.name;n.key.name=`_$$${s}`;let t=e.body.indexOf(n),r=J(`
    function ${s}() {
        return this._$$${s}
    }`),i=J(`
    function ${s}(value) {
        if (this._$$${s} === value) return
        this._$$${s} = value
        this._$runDeps("${s}")
<<<<<<< Updated upstream
    }`),[o,a]=V(s,r.body,i.body);e.body.splice(t+1,0,o,a)}function q(n,e,s){let t=n.key.name,r=e.body.indexOf(n),i=s.toLowerCase(),o=E.classProperty(E.identifier(`_$$${t}`),E.stringLiteral(`_$${i}`));e.body.splice(r,0,o)}var h=y(require("@babel/types"));function _e(n){return!["If","For","TextNode"].includes(n.tag)}function Z(n){return n.tag[0].toUpperCase()===n.tag[0]&&_e(n)}function z(n){return`${n}
`}function Q(n){return"["+n.children.map((e,s)=>`_$node${s}`).join(", ")+"]"}var $=class{value="";add(e){this.value+=z(e)}shift(e){this.value=z(e)+this.value}addBody(e){this.value+=e.value}};var P=y(require("@babel/core")),Y=y(require("@babel/generator")),j={transform:P.transform,traverse:P.traverse,parse:P.parse,generator:Y.default},X={...j};function ee(n){let e;n==="babel"&&(e=j),X.transform=e.transform,X.traverse=e.traverse,X.parse=e.parse,X.generator=e.generator}var S=X;var l={transform:{ts:n=>S.transform(n,{filename:"*.ts",presets:["@babel/preset-typescript"]}).code},traverse:S.traverse,generate:n=>S.generator(n).code,parse:{deco:n=>S.parse(n,{filename:"*.ts",presets:["@babel/preset-typescript"],plugins:[["@babel/plugin-proposal-decorators",{legacy:!0}]]}),ts:n=>S.parse(n,{filename:"*.ts",presets:["@babel/preset-typescript"]}),jsx:n=>S.parse(n,{presets:["@babel/preset-react"]}),all:n=>S.parse(n,{filename:"*.jsx",presets:["@babel/preset-react","@babel/preset-typescript"],plugins:[["@babel/plugin-proposal-decorators",{legacy:!0}]]})}};var N=y(require("@babel/types"));function v(n){return"["+n.map(e=>'"'+e+'"').join(", ")+"]"}function w(){return Math.random().toString(20).slice(2,8)}function te(n,e,s=[]){let t=l.parse.ts(`(${n})`),r=[];return l.traverse(t,{MemberExpression(i){e.includes(i.node.property.name)&&A(i)&&r.push(i.node.property.name)}}),r=[...new Set([...r,...s])],r}function se(n,e,s=[]){let t=l.parse.ts(`(${n})`),r=[];return l.traverse(t,{Identifier(i){for(let{ids:o,propNames:a}of e)o.includes(i.node.name)&&(M(i)||r.push(...a))}}),r=[...new Set([...r,...s])],r}function re(n){return n.match(/[_$a-zA-Z][_$a-zA-Z0-9]*/g)??[]}function T(n){let e=l.parse.ts(`(${n})`);return N.isMemberExpression(e.program.body[0].expression)}function ne(n,e){let s=[],t=l.parse.ts(e);l.traverse(t,{Identifier(i){s.push(i.node.name)}});let r=l.parse.ts(`function tempFunc() {${n}}`);return l.traverse(r,{Identifier(i){if(s.includes(i.node.name)&&!N.isMemberExpression(i.parentPath.node)){let o=N.memberExpression(N.identifier("_$valuedItem"),N.identifier(i.node.name));i.replaceWith(o),i.skip()}}}),l.generate(r.program.body[0].body).trim().replace(/(^\{)|(\}$)/g,"")}var _=class{depChain;idDepsArr=[];constructor(e){this.depChain=e}generate(e){let s=new $;for(let[t,r]of e.children.entries())s.addBody(this.resolveParserNode(r,t));return s.add(`return ${Q(e)}`),s.value}geneDeps(e){return[...new Set([...te(e,this.depChain),...se(e,this.idDepsArr)])]}resolveParserNode(e,s){return e.tag==="Exp"?this.resolveExpression(e,s):e.tag==="If"?this.resolveIf(e,s):e.tag==="For"?this.resolveFor(e,s):e.tag==="Env"?this.resolveEnv(e,s):Z(e)?this.resolveCustom(e,s):e.tag==="text"?this.resolveText(e,s):this.resolveHTML(e,s)}resolveIf(e,s){let t=new $,r=`_$node${s}`;t.add(`const ${r} = new _$.IfNode()`);for(let i in e.kv.condition){let o=e.kv.condition[i];t.add(`${r}._$addCond(() => ${o.condition}, () => {`),t.add(this.generate(o.parserNode));let a=this.geneDeps(o.condition);if(a.length>0){t.add(`}, this, ${v(a)})`);continue}t.add("})")}return t}resolveFor(e,s){let t=new $,r=e.kv.key,i=/^(?:(?:let)|(?:var))\s+?(.+?)\s+?(?:of)\s+?(.+?)$/,o=e.kv.forValue.replace(i,"$1"),a=e.kv.forValue.replace(i,"$2"),d=`_$node${s}`;t.add(`const ${d} = new _$.ForNode()`);let m=this.geneDeps(a);if(m.length>0){t.add(`const ${d}_for = ${d}`),t.add(`${d}_for._$addNodeFunc((_$key, _$idx) => {`);let b=o.match(/[_$a-zA-Z][_$a-zA-Z0-9]*/g)??[];t.add(`const ${o} = ${d}_for._$getItem(_$key, _$idx)`),t.add("const _$valuedItem = {}");for(let f of b)t.add(`_$valuedItem.${f} = ${f}`);t.add(`${d}_for._$listen(this, ()=>${d}_for._$getItem(_$key, _$idx),             ${v(m)}, (_$item) => {`),t.add(`const ${o} = _$item`);for(let f of b)t.add(`_$valuedItem.${f} = ${f}`);t.add("})");let p=new _(this.depChain);p.idDepsArr=[{ids:re(o),propNames:m}];let x=p.generate(e);x=ne(x,o),t.add(x),t.add("})"),r&&(t.add(`${d}._$addKeyFunc(() => {`),t.add("const keys = []"),t.add(`for (${e.kv.forValue}) {`),t.add(`keys.push(${r})`),t.add("}"),t.add("return keys"),t.add("})")),t.add(`${d}._$addArrayFunc(this, () => (${a}), ${v(m)})`)}else t.add(`${d}._$addNodess(Array.from(${a}).map((${o}) => (() => {`),t.add(this.generate(e)),t.add("})()))");return t}resolveText(e,s){let t=new $,r=e.kv.value,i=e.kv.strSymbol,o=this.geneDeps(`${i}${r}${i}`),a=`_$node${s}`;return o.length>0?t.add(`const ${a} = new _$.TextNode(() => ${i}${r}${i}, this, ${v(o)})`):t.add(`const ${a} = new _$.TextNode(${i}${r}${i}, )`),t}resolveHTML(e,s){let t=new $,r=`_$node${s}`;t.add(`const ${r} = new _$.HtmlNode("${e.tag}", )`);for(let{key:i,value:o,nodes:a}of e.kv.props){if(o=this.parsePropNodes(o,a),i==="element"){t.add(`${o} = ${r}._$el`);continue}if(["willAppear","didAppear","willDisappear","didDisappear"].includes(i)){t.add(`${r}._$addLifeCycle(${o}, "${i}")`);continue}i==="_$content"&&(i="innerText");let d=this.geneDeps(o);if(d.length>0){t.add(`${r}._$addProp("${i}", () => (${o}), this, ${v(d)})`);continue}t.add(`${r}._$addProp("${i}", ${o})`)}return e.children.length>0&&(t.add(`${r}._$addNodes((() => {`),t.add(this.generate(e)),t.add("})())")),t}resolveCustom(e,s){let t=new $,r=`_$node${s}`;t.add(`const ${r} = new ${e.tag}()`);for(let{key:i,value:o,nodes:a}of e.kv.props){if(o=this.parsePropNodes(o,a),i==="element"){t.add(`${r}._$addAfterset(() => ${o} = ${r}._$el)`);continue}if(["willMount","didMount","willUnmount","didUnmount"].includes(i)){t.add(`${r}._$addLifeCycle(${o}, "${i}")`);continue}let d=this.geneDeps(o);if(d.length>0){t.add(`${r}._$addProp("${i}", () => (${o}), this, ${v(d)}, ${T(o)})`);continue}t.add(`${r}._$addProp("${i}", ${o})`)}if(e.children.length>0){t.add(`${r}._$addChildren([`);for(let i of e.children)t.add("() => {"),t.addBody(this.resolveParserNode(i,0)),t.add("return _$node0"),t.add("},");t.add("])")}return t}resolveEnv(e,s){let t=new $,r=`_$node${s}`;t.add(`const ${r} = new _$.EnvNode()`),e.children.length>0&&(t.add(`${r}._$addNodes((() => {`),t.add(this.generate(e)),t.add("})())"));for(let{key:i,value:o,nodes:a}of e.kv.props){o=this.parsePropNodes(o,a);let d=this.geneDeps(o);if(d.length>0){t.add(`${r}._$addProp("${i}", () => (${o}), this, ${v(d)}, ${T(o)})`);continue}t.add(`${r}._$addProp("${i}", ${o})`)}return t}resolveExpression(e,s){let t=new $,r=`_$node${s}`;for(let{key:i,value:o,nodes:a}of e.kv.props){if(o=this.parsePropNodes(o,a),i==="_$content"){let m=this.geneDeps(o);m.length>0?t.add(`const ${r} = new _$.ExpressionNode(() => ${o}, this, ${v(m)})`):t.add(`const ${r} = new _$.ExpressionNode(${o}, )`);continue}if(i==="onUpdateNodes"){t.add(`${r}._$onUpdateNodes(${o})`);continue}let d=this.geneDeps(o);if(d.length>0){t.add(`${r}._$addProp("${i}", () => (${o}), this, ${v(d)}, ${T(o)})`);continue}t.add(`${r}._$addProp("${i}", ${o})`)}return t}parsePropNodes(e,s){for(let[t,r]of Object.entries(s)){let i=new $;i.add("((()=>{"),i.add(this.generate(r)),i.add("})())"),e=e.replace('"'+t+'"',i.value)}return e}};function oe(n,e){return new _(e).generate(n)}function ie(n,e){let s=l.parse.deco(n),t=null,r=null,i=null,o=null,a=[];return l.traverse(s,{ClassDeclaration(b){let p=b.node;if(h.isIdentifier(p.superClass)){t=p,r=t.body,r.body.unshift(h.classProperty(h.identifier("_$tag"),h.stringLiteral(t.id.name))),o=h.classProperty(h.identifier("_$derivedPairs"),h.objectExpression([])),i=h.classProperty(h.identifier("_$deps"),h.objectExpression([])),a=[];return}},ClassProperty(b){if(!t)return;let p=b.node;if(h.isIdentifier(p.key,{name:"Body"})){let f=p.value.value,I=oe(e[f],a),ge=l.transform.ts(`
=======
    }`),[o,a]=V(s,r.body,i.body);e.body.splice(t+1,0,o,a)}function q(n,e,s){let t=n.key.name,r=e.body.indexOf(n),i=s.toLowerCase(),o=E.classProperty(E.identifier(`_$$${t}`),E.stringLiteral(`_$${i}`));e.body.splice(r,0,o)}var h=y(require("@babel/types"));function Be(n){return!["If","For","TextNode"].includes(n.tag)}function Z(n){return n.tag[0].toUpperCase()===n.tag[0]&&Be(n)}function z(n){return`${n}
`}function Q(n){return"["+n.children.map((e,s)=>`_$node${s}`).join(", ")+"]"}var $=class{value="";add(e){this.value+=z(e)}shift(e){this.value=z(e)+this.value}addBody(e){this.value+=e.value}};var P=y(require("@babel/core")),Y=y(require("@babel/generator")),j={transform:P.transform,traverse:P.traverse,parse:P.parse,generator:Y.default},X={...j};function ee(n){let e;n==="babel"&&(e=j),X.transform=e.transform,X.traverse=e.traverse,X.parse=e.parse,X.generator=e.generator}var N=X;var l={transform:{ts:n=>N.transform(n,{filename:"*.ts",presets:["@babel/preset-typescript"]}).code},traverse:N.traverse,generate:n=>N.generator(n).code,parse:{deco:n=>N.parse(n,{filename:"*.ts",presets:["@babel/preset-typescript"],plugins:[["@babel/plugin-proposal-decorators",{legacy:!0}]]}),ts:n=>N.parse(n,{filename:"*.ts",presets:["@babel/preset-typescript"]}),jsx:n=>N.parse(n,{presets:["@babel/preset-react"]}),all:n=>N.parse(n,{filename:"*.jsx",presets:["@babel/preset-react","@babel/preset-typescript"],plugins:[["@babel/plugin-proposal-decorators",{legacy:!0}]]})}};var b=y(require("@babel/types"));function k(n){return"["+n.map(e=>'"'+e+'"').join(", ")+"]"}function w(){return Math.random().toString(20).slice(2,8)}function te(n,e,s=[]){let t=l.parse.ts(`(${n})`),r=[];return l.traverse(t,{MemberExpression(i){e.includes(i.node.property.name)&&A(i)&&r.push(i.node.property.name)}}),r=[...new Set([...r,...s])],r}function se(n,e,s=[]){let t=l.parse.ts(`(${n})`),r=[];return l.traverse(t,{Identifier(i){for(let{ids:o,propNames:a}of e)o.includes(i.node.name)&&(M(i)||r.push(...a))}}),r=[...new Set([...r,...s])],r}function re(n){return n.match(/[_$a-zA-Z][_$a-zA-Z0-9]*/g)??[]}function T(n){let e=l.parse.ts(`(${n})`);return b.isMemberExpression(e.program.body[0].expression)}function ne(n,e){let s=[],t=l.parse.ts(e);l.traverse(t,{Identifier(i){s.push(i.node.name)}});let r=l.parse.ts(`function tempFunc() {${n}}`);return l.traverse(r,{Identifier(i){if(s.includes(i.node.name)&&!b.isMemberExpression(i.parentPath.node)){let o=b.memberExpression(b.identifier("_$valuedItem"),b.identifier(i.node.name));i.replaceWith(o),i.skip()}}}),l.generate(r.program.body[0].body).trim().replace(/(^\{)|(\}$)/g,"")}function oe(n){let e=l.parse.ts(`let _ = ${n}`).program.body[0].declarations[0].init;return!!(b.isArrowFunctionExpression(e)||b.isFunctionExpression(e))}var _=class{depChain;idDepsArr=[];constructor(e){this.depChain=e}generate(e){let s=new $;for(let[t,r]of e.children.entries())s.addBody(this.resolveParserNode(r,t));return s.add(`return ${Q(e)}`),s.value}geneDeps(e){return[...new Set([...te(e,this.depChain),...se(e,this.idDepsArr)])]}resolveParserNode(e,s){return e.tag==="Exp"?this.resolveExpression(e,s):e.tag==="If"?this.resolveIf(e,s):e.tag==="For"?this.resolveFor(e,s):e.tag==="Env"?this.resolveEnv(e,s):Z(e)?this.resolveCustom(e,s):e.tag==="text"?this.resolveText(e,s):this.resolveHTML(e,s)}resolveIf(e,s){let t=new $,r=`_$node${s}`;t.add(`const ${r} = new _$.IfNode()`);for(let i in e.kv.condition){let o=e.kv.condition[i];t.add(`${r}._$addCond(() => ${o.condition}, () => {`),t.add(this.generate(o.parserNode));let a=this.geneDeps(o.condition);if(a.length>0){t.add(`}, this, ${k(a)})`);continue}t.add("})")}return t}resolveFor(e,s){let t=new $,r=e.kv.key,i=/^(?:(?:let)|(?:var))\s+?(.+?)\s+?(?:of)\s+?(.+?)$/,o=e.kv.forValue.replace(i,"$1"),a=e.kv.forValue.replace(i,"$2"),d=`_$node${s}`;t.add(`const ${d} = new _$.ForNode()`);let f=this.geneDeps(a);if(f.length>0){t.add(`const ${d}_for = ${d}`),t.add(`${d}_for._$addNodeFunc((_$key, _$idx) => {`);let v=o.match(/[_$a-zA-Z][_$a-zA-Z0-9]*/g)??[];t.add(`const ${o} = ${d}_for._$getItem(_$key, _$idx)`),t.add("const _$valuedItem = {}");for(let m of v)t.add(`_$valuedItem.${m} = ${m}`);t.add(`${d}_for._$listen(this, ()=>${d}_for._$getItem(_$key, _$idx),             ${k(f)}, (item) => {`),t.add(`const ${o} = item`);for(let m of v)t.add(`_$valuedItem.${m} = ${m}`);t.add("})");let p=new _(this.depChain);p.idDepsArr=[{ids:re(o),propNames:f}];let S=p.generate(e);S=ne(S,o),t.add(S),t.add("})"),r&&(t.add(`${d}._$addKeyFunc(() => {`),t.add("const keys = []"),t.add(`for (${e.kv.forValue}) {`),t.add(`keys.push(${r})`),t.add("}"),t.add("return keys"),t.add("})")),t.add(`${d}._$addArrayFunc(this, () => (${a}), ${k(f)})`)}else t.add(`${d}._$addNodess(Array.from(${a}).map((${o}) => (() => {`),t.add(this.generate(e)),t.add("})()))");return t}resolveText(e,s){let t=new $,r=e.kv.value,i=e.kv.strSymbol,o=this.geneDeps(`${i}${r}${i}`),a=`_$node${s}`;return o.length>0?t.add(`const ${a} = new _$.TextNode(() => ${i}${r}${i}, this, ${k(o)})`):t.add(`const ${a} = new _$.TextNode(${i}${r}${i}, )`),t}resolveHTML(e,s){let t=new $,r=`_$node${s}`;t.add(`const ${r} = new _$.HtmlNode("${e.tag}", )`);for(let{key:i,value:o,nodes:a}of e.kv.props){if(o=this.parsePropNodes(o,a),i==="element"){t.add(`${o} = ${r}._$el`);continue}if(["willAppear","didAppear","willDisappear","didDisappear"].includes(i)){t.add(`${r}._$addLifeCycle(${o}, "${i}")`);continue}i==="_$content"&&(i="innerText");let d=this.geneDeps(o);if(d.length>0){t.add(`${r}._$addProp("${i}", () => (${o}), this, ${k(d)})`);continue}t.add(`${r}._$addProp("${i}", ${o})`)}return e.children.length>0&&(t.add(`${r}._$addNodes((() => {`),t.add(this.generate(e)),t.add("})())")),t}resolveCustom(e,s){let t=new $,r=`_$node${s}`;t.add(`const ${r} = new ${e.tag}()`);for(let{key:i,value:o,nodes:a}of e.kv.props){if(o=this.parsePropNodes(o,a),i==="element"){oe(o)?t.add(`${r}._$addAfterset(() => (${o})(${r}._$el))`):t.add(`${r}._$addAfterset(() => ${o} = ${r}._$el)`);continue}if(["willMount","didMount","willUnmount","didUnmount"].includes(i)){t.add(`${r}._$addLifeCycle(${o}, "${i}")`);continue}let d=this.geneDeps(o);if(d.length>0){t.add(`${r}._$addProp("${i}", () => (${o}), this, ${k(d)}, ${T(o)})`);continue}t.add(`${r}._$addProp("${i}", ${o})`)}if(e.children.length>0){t.add(`${r}._$addChildren([`);for(let i of e.children)t.add("() => {"),t.addBody(this.resolveParserNode(i,0)),t.add("return _$node0"),t.add("},");t.add("])")}return t}resolveEnv(e,s){let t=new $,r=`_$node${s}`;t.add(`const ${r} = new _$.EnvNode()`),e.children.length>0&&(t.add(`${r}._$addNodes((() => {`),t.add(this.generate(e)),t.add("})())"));for(let{key:i,value:o,nodes:a}of e.kv.props){o=this.parsePropNodes(o,a);let d=this.geneDeps(o);if(d.length>0){t.add(`${r}._$addProp("${i}", () => (${o}), this, ${k(d)}, ${T(o)})`);continue}t.add(`${r}._$addProp("${i}", ${o})`)}return t}resolveExpression(e,s){let t=new $,r=`_$node${s}`;for(let{key:i,value:o,nodes:a}of e.kv.props){if(o=this.parsePropNodes(o,a),i==="_$content"){let f=this.geneDeps(o);f.length>0?t.add(`const ${r} = new _$.ExpressionNode(() => ${o}, this, ${k(f)})`):t.add(`const ${r} = new _$.ExpressionNode(${o}, )`);continue}if(i==="onUpdateNodes"){t.add(`${r}._$onUpdateNodes(${o})`);continue}let d=this.geneDeps(o);if(d.length>0){t.add(`${r}._$addProp("${i}", () => (${o}), this, ${k(d)}, ${T(o)})`);continue}t.add(`${r}._$addProp("${i}", ${o})`)}return t}parsePropNodes(e,s){for(let[t,r]of Object.entries(s)){let i=new $;i.add("((()=>{"),i.add(this.generate(r)),i.add("})())"),e=e.replace('"'+t+'"',i.value)}return e}};function ie(n,e){return new _(e).generate(n)}function ae(n,e){let s=l.parse.deco(n),t=null,r=null,i=null,o=null,a=[];return l.traverse(s,{ClassDeclaration(v){let p=v.node;if(h.isIdentifier(p.superClass)){t=p,r=t.body,r.body.unshift(h.classProperty(h.identifier("_$tag"),h.stringLiteral(t.id.name))),o=h.classProperty(h.identifier("_$derivedPairs"),h.objectExpression([])),i=h.classProperty(h.identifier("_$deps"),h.objectExpression([])),a=[];return}},ClassProperty(v){if(!t)return;let p=v.node;if(h.isIdentifier(p.key,{name:"Body"})){let m=p.value.value,I=ie(e[m],a),ye=l.transform.ts(`
>>>>>>> Stashed changes
                    function tmp() {
                        ${I}
                    }
                `);p.value=h.arrowFunctionExpression([],J(ye).body);return}let S=[];if(v.scope.traverse(p,{MemberExpression(m){a.includes(m.node.property.name)&&A(m,t)&&S.push(m.node.property.name)}}),S=[...new Set(S)],S.length>0&&(W(p.key.name,S,o,r),D(p.key.name,i,r),R(p),a.push(p.key.name)),p.decorators){for(let m of p.decorators){let I=m.expression.name??m.expression.callee.name;if(["EnvState","PropState","State"].includes(I)){a.push(p.key.name),D(p.key.name,i,r),U(p,r);break}if(["Prop","Env"].includes(I)){a.push(p.key.name),D(p.key.name,i,r),q(p,r,I);break}}p.decorators=null}}}),`import * as _$ from "@dlightjs/dlight" 
`+l.generate(s)}var u=class{tag="";kv={props:[]};children=[];parent;constructor(e){this.tag=e}get lastChild(){return this.children.length===0?this:this.children[this.children.length-1]}addChild(e){this.children.push(e),e.parent=this}addChildren(e){for(let s of e)this.addChild(s)}};var g=y(require("@babel/types"));var x=class{parserNode=new u("");jsxElement;constructor(e){this.jsxElement=e}resolveEl(e){let s=e.openingElement.name.name,t=new u(s);for(let r of e.openingElement.attributes){r=r;let i=r.name.name,o=r.value,a=g.isJSXExpressionContainer(o)?this.parseProp(i,o.expression):{key:i,value:l.generate(o),nodes:{}};t.kv.props.push(a)}for(let r of e.children){let i=new x(r);i.parse(),t.addChildren(i.parserNode.children)}this.parserNode.addChild(t)}resolveFragment(e){for(let s of e.children)this.resolveJSXElement(s)}resolveText(e){let s=new u("text"),t=e.value.trim();t!==""&&(s.kv.strSymbol="`",s.kv.value=t,this.parserNode.addChild(s))}parseProp(e,s){let t=l.parse.jsx(l.generate(s)),r={key:e,nodes:{}};l.traverse(t,{JSXElement(o){let a=w(),d=new x(o.node);d.parse(),r.nodes[a]=d.parserNode,o.replaceWith(g.stringLiteral(a))}});let i=l.generate(t).trim().replace(/;$/g," ");return i.trim()===""&&(i='""'),r.value=i,r}resolveFor(e){let s=new u("For"),t=e.openingElement.attributes.filter(o=>o.name.name==="expression")[0],r="";if(t!==void 0){let o=t.value;r=g.isJSXExpressionContainer(o)?l.generate(o.expression):l.generate(o).replace(/(^["'`])|(["'`]$)/g,"")}s.kv.forValue=r;let i=e.openingElement.attributes.filter(o=>o.name.name==="key")[0];if(i!==void 0){let o=i.value;s.kv.key=g.isJSXExpressionContainer(o)?l.generate(o.expression):l.generate(o).replace(/(^["'`])|(["'`]$)/g,"")}for(let o of e.children){let a=new x(o);a.parse(),s.addChildren(a.parserNode.children)}this.parserNode.addChild(s)}resolveIf(e){let s=new u("If"),t=e.openingElement.attributes.filter(o=>o.name.name==="condition")[0],r="";if(t!==void 0){let o=t.value;r=g.isJSXExpressionContainer(o)?l.generate(o.expression):l.generate(o)}let i=new x(e.children);i.parse(),s.kv.condition=[{condition:r,parserNode:i.parserNode}],this.parserNode.addChild(s)}resolveElseIf(e){let s=this.parserNode.lastChild,t=e.openingElement.attributes.filter(o=>o.name.name==="condition")[0],r="";if(t!==void 0){let o=t.value;r=g.isJSXExpressionContainer(o)?l.generate(o.expression):l.generate(o)}let i=new x(e.children);i.parse(),s.kv.condition!==void 0&&s.kv.condition.push({condition:r,parserNode:i.parserNode})}resolveElse(e){let s=this.parserNode.lastChild,t=new x(e.children);t.parse(),s.kv.condition!==void 0&&s.kv.condition.push({condition:"true",parserNode:t.parserNode})}resolveJSXExpression(e){let s=new u("Exp");s.kv.props.push(this.parseProp("_$content",e.expression)),this.parserNode.addChild(s)}resolveJSXElement(e){if(Array.isArray(e))return e.forEach(t=>this.resolveJSXElement(t));if(g.isJSXFragment(e))return this.resolveFragment(e);if(g.isJSXText(e))return this.resolveText(e);if(g.isJSXExpressionContainer(e))return this.resolveJSXExpression(e);let s=e.openingElement.name.name;if(s==="For")return this.resolveFor(e);if(s==="If")return this.resolveIf(e);if(s==="ElseIf")return this.resolveElseIf(e);if(s==="Else")return this.resolveElse(e);this.resolveEl(e)}parse(){this.resolveJSXElement(this.jsxElement)}};function de(n){let s=l.parse.jsx(n).program.body[0].expression,t=new x(s);return t.parse(),t.parserNode}var le=y(require("@babel/types"));var Ie=/(\/\*[\S\s]*\*\/)|(\/\/.*)/g;function pe(n){let e={},s=l.parse.all(n);return l.traverse(s,{ClassProperty(r){if(r.node.key.name==="Body"){let i=w();e[i]=l.generate(r.node.value).replace(Ie,""),r.node.value=le.stringLiteral(i)}}}),{code:l.generate(s),bodyMap:e}}var ce={bodyGetter:pe,bodyParser:de};var L=class{code;codeOut="";c="";idx=-1;flag=!1;commentRegex=/(\/\*[\S\s]*\*\/)|(\/\/.*)/g;bodyMap={};constructor(e){this.code=e}ok(){return this.idx<this.code.length-1}look(){return this.code[this.idx+1]}eat(){this.idx++,this.c=this.code[this.idx]}add(){this.codeOut+=this.c}eatSpace(){for(;this.ok()&&this.look().trim()==="";)this.eat()}metBody(){return/Body\(\)\s*\{$/.test(this.codeOut)}eatBrackets(){this.flag||(this.flag=!0);let e="",s=1;for(;this.ok();){if(this.eat(),this.c==="{")s++;else if(this.c==="}"&&(s--,s===0))break;e+=this.c}return e}eatBody(){this.eatSpace();let e=w(),s=this.eatBrackets();this.bodyMap[e]=s.replace(this.commentRegex,""),this.codeOut=this.codeOut.replace(/\(\)\s*\{$/,"")+`= "${e}"`}parse(){for(;this.ok();){for(;this.ok()&&!this.metBody();)this.eat(),this.add();this.ok()&&this.eatBody()}return this.codeOut}};function he(n){let e=new L(n);return e.parse(),{code:e.codeOut,bodyMap:e.bodyMap}}var ue=y(require("@babel/core")),fe=y(require("@babel/generator")),Je={filename:"*.ts",presets:["@babel/preset-typescript"]},Xe=n=>ue.parse(n,Je),Fe=n=>(0,fe.default)(n).code,B=class{code;token="";c="";idx=-1;constructor(e){this.code=e}stopCharacters=["(","{"," ",`
`,'"',"`","'"];ok(){return this.idx<this.code.length-1}look(){return this.code[this.idx+1]}eat(){this.idx++,this.c=this.code[this.idx]}add(){this.token+=this.c}erase(){this.token=""}eatSpace(){for(;this.ok()&&this.look().trim()==="";)this.eat()}parserNode=new u("null");get el(){return this.parserNode.lastChild}addElKey(){let e=this.token.slice(1);this.erase(),this.eatSpace(),this.eat(),this.eatSpace();let s=this.eatContent();s.trim()===""&&(s="true"),this.el.kv.props.push(this.parseProp(e,s)),this.erase()}eatBrackets(e,s){let t=1;for(;this.ok();){if(this.eat(),this.c===e)t++;else if(this.c===s&&(t--,t===0))break;this.add()}}eatParentheses(){this.eatBrackets("(",")")}eatCurlyBrackets(){this.eatBrackets("{","}")}eatSquareBrackets(){this.eatBrackets("[","]")}eatContent(){this.eatParentheses();let e=this.token;return this.erase(),e}eatSubEl(){this.eatCurlyBrackets();let e=new B(this.token);return e.parse(),this.erase(),e.parserNode}parse(){for(;this.ok();){for(;this.ok()&&!this.stopCharacters.includes(this.look());)this.eat(),this.add();if(this.token.trim()!==""){if(["If","ElseIf","Else"].includes(this.token)){this.resolveIf(this.token);continue}if(["For"].includes(this.token)){this.resolveFor();continue}if(this.token.startsWith(".")){this.addElKey();continue}this.resolveEl()}else if(this.eat(),['"',"'","`"].includes(this.c)){this.add();let e=this.c;for(;this.ok()&&(["\\"].includes(this.c)||this.look()!==e);)this.eat(),this.add();this.ok()&&(this.eat(),this.add(),this.resolveText())}}}parseProp(e,s){let t=0,r="",i="",o=!1,a={key:e,nodes:{}};for(let d=0;d<s.length;d++)if(s[d]==="@"&&s[d+1]==="{")o=!0,t++,d++;else if(s[d]==="}"&&t===1&&o){t--;let f=w();i+='"'+f+'"';let v=new B(r);v.parse(),a.nodes[f]=v.parserNode,r="",o=!1}else t!==0&&o?(s[d]==="{"?t++:s[d]==="}"&&t--,r+=s[d]):(s[d]==="{"?t++:s[d]==="}"&&t--,i+=s[d]);return a.value=i,a}resolveText(){let e=new u("text");e.kv.strSymbol=this.token[0],e.kv.value=this.token.slice(1,-1),this.erase(),this.parserNode.addChild(e)}resolveEl(){let e=new u(this.token);if(this.erase(),this.eatSpace(),this.look()==="("){if(this.eat(),this.eatSpace(),this.look()==="{"){let s=this.eatContent(),r=Xe(`(${s})`).program.body[0].expression.properties;for(let i of r)e.kv.props.push(this.parseProp(i.key.name,Fe(i.value)))}else{let s=this.eatContent();s.trim()!==""&&e.kv.props.push(this.parseProp("_$content",s))}this.eatSpace()}this.look()==="{"&&(this.eat(),e.children=this.eatSubEl().children),this.parserNode.addChild(e)}handleIfish(e){this.erase(),this.eatSpace(),this.eat();let s=this.eatSubEl();this.el.kv.condition.push({condition:e,parserNode:s}),this.erase()}handleIf(){this.parserNode.addChild(new u(this.token)),this.erase(),this.eatSpace(),this.eat(),this.eatParentheses(),this.el.kv.condition=[],this.handleIfish(this.token)}handleElseIf(){this.erase(),this.eatSpace(),this.eat(),this.eatParentheses(),this.handleIfish(this.token)}handleElse(){this.handleIfish("true")}resolveIf(e){e==="If"?this.handleIf():e==="ElseIf"?this.handleElseIf():e==="Else"&&this.handleElse()}resolveFor(){let e=new u(this.token);this.erase(),this.eatSpace(),this.eat(),this.eatParentheses(),e.kv.forValue=this.token,this.erase(),this.eatSpace(),this.eat(),this.c==="["&&(this.eatSquareBrackets(),e.kv.key=this.token,this.erase(),this.eatSpace(),this.eat()),e.children=this.eatSubEl().children,this.parserNode.addChild(e)}};function me(n){let e=new B(n);return e.parse(),e.parserNode}var ge={bodyGetter:he,bodyParser:me};function De(n,e,s="babel"){ee(s);let{bodyGetter:t,bodyParser:r}=e,{code:i,bodyMap:o}=t(n),a={};for(let[d,f]of Object.entries(o))a[d]=r(f);return ae(i,a)}0&&(module.exports={JSDConfig,JSXConfig,geneParserNode});
