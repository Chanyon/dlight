var S=Object.defineProperty;var L=(s,e,t)=>e in s?S(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var i=(s,e,t)=>(L(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const r of d.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerpolicy&&(d.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?d.credentials="include":o.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(o){if(o.ep)return;o.ep=!0;const d=t(o);fetch(o.href,d)}})();function x(s){for(let e of s){if(Array.isArray(e)){x(e);continue}e._$init()}}function v(s,e){for(let t of s){if(Array.isArray(t)){v(t,e);continue}t._$parentNode=e}}function w(s,e){for(let t of s)e(t)&&w(t._$nodes,e)}function N(s,e,t=!0){for(let n of s)[0,1].includes(n._$nodeType)?(e(n._$el,n),t&&N(n._$nodes,e)):N(n._$nodes,e,t)}function j(s){let e=[];return N(s,(t,n)=>{n._$nodeType===0&&e.push(t)},!1),e}var E=(s=>(s[s.HTML=0]="HTML",s[s.Text=1]="Text",s[s.Custom=2]="Custom",s[s.For=3]="For",s[s.If=4]="If",s[s.Env=5]="Env",s[s.Expression=6]="Expression",s))(E||{}),I=class{constructor(s){i(this,"_$nodeType");i(this,"__$el");i(this,"_$parentNode");i(this,"_$nodes",[]);i(this,"_$depObjectIds",[]);this._$nodeType=s}get _$el(){return this.__$el??j(this._$nodes)}set _$el(s){this.__$el=s}_$beforeInitSubNodes(){}_$addBeforeInitSubNodes(s){let e=this._$beforeInitSubNodes;this._$beforeInitSubNodes=function(){e.call(this),s.call(this)}}_$bindNodes(){v(this._$nodes,this),this._$beforeInitSubNodes(),x(this._$nodes)}_$init(){}};function H(s,e,t,n,o,d,r){if(t in s){if(!d){s[t]=n;return}if(!(s[`_$$${t}`]!==`_$${e}`||!(`_$$${t}`in s))){if(s[`_$$${t}`]===`_$${e}`){W(o,s,t,n,d);return}if(r&&`_$$${d[0]}`in o){q(o,s,t,n,d);return}z(o,s,t,n,d)}}}function W(s,e,t,n,o){let d={};e._$depObjectIds.push(d),e[t]=n(),s._$addDeps(o,d,()=>{e[t]=n(),e._$runDeps(t)})}function q(s,e,t,n,o){let d={};e._$depObjectIds.push(d);for(let r of o){let a=()=>s[r]=e[t];e._$addDeps([t],d,a),e[t]=n(),s._$addDeps(o,d,()=>{e._$deleteDep(t,d),e[t]=n(),e._$addDeps([t],d,a)})}}function z(s,e,t,n,o){let d={};e._$depObjectIds.push(d),e[`_$${t}`]=n(),s._$addDeps(o,d,()=>{e[`_$${t}`]=n(),e._$runDeps(t)})}var G=class extends I{constructor(){super(2);i(this,"_$deps",{});i(this,"_$envNodes");i(this,"_$derivedPairs");i(this,"_$tag","");i(this,"Body",()=>[]);i(this,"_$childrenFunc");i(this,"_$_children")}_$addAfterset(e){let t=this.Preset;this.Preset=()=>{t(),e()}}_$runDeps(e){if(this._$deps[e]===void 0){console.warn(`${e} is not a dependency in ${this.constructor.name}`);return}for(let t of this._$deps[e].values())t.call(this)}get _$children(){return this._$childrenFunc?(this._$_children||(this._$_children=this._$childrenFunc.map(e=>e())),this._$_children):[]}_$addChildren(e){this._$childrenFunc=e}_$initDecorators(){if(this._$derivedPairs)for(let[e,t]of Object.entries(this._$derivedPairs)){let n=this[e];if(typeof n!="function")return;this[e]=this[e]();let o=this[e];this._$addDeps(t,{},()=>{let d=n();d!==o&&(this[e]=d,o=d,this._$runDeps(e))})}}_$addDeps(e,t,n){for(let o of e)this._$deps[o].set(t,n)}_$deleteDep(e,t){this._$deps[e].delete(t)}_$deleteDeps(e){for(let t in this._$deps)this._$deleteDep(t,e)}AfterConstruct(){}Preset(){}Afterset(){}_$init(){this.AfterConstruct(),this._$initDecorators(),this.Preset(),this._$nodes=this.Body(),this.Afterset(),this._$bindNodes()}_$addProp(e,t,n,o,d){H(this,"prop",e,t,n,o,d)}willMount(e,t){}didMount(e,t){}willUnmount(e,t){}didUnmount(e,t){}_$addLifeCycle(e,t){let n=this[t];this[t]=function(o,d){e.call(this,this._$el,this),n.call(this,this._$el,this)}}render(e){let t=new c("div");t._$addNodes([this]),t._$addProp("id",typeof e=="string"?e:e.id),t._$init(),this.willMount(this._$el,this),w(this._$nodes,n=>{switch(n._$nodeType){case 0:n.willAppear(n._$el,n);break;case 2:n.willMount(n._$el,n);break}return!0}),typeof e=="string"&&(e=document.getElementById(e)),e.replaceWith(t._$el),w(this._$nodes,n=>{switch(n._$nodeType){case 0:n.didAppear(n._$el,n);break;case 2:n.didMount(n._$el,n);break}return!0}),this.didMount(this._$el,this)}};function C(s,e){w(e,t=>{switch(t._$nodeType){case 1:case 0:s._$el.appendChild(t._$el);break;default:C(s,t._$nodes);break}return!1})}function F(s){Y(s),N(s,(e,t)=>{!document.body.contains(e)||(t._$nodeType===0&&t.willDisappear(e,t),e.remove(),t._$nodeType===0&&t.didDisappear(e,t))}),Q(s)}function T(s,e){w(s,t=>{for(let n of t._$depObjectIds)e._$deleteDeps(n);return!0})}function P(s,e,t,n){let o=n??t.childNodes.length;return J(s),N(s,(d,r)=>{let a=document.body.contains(d);[0].includes(r._$nodeType)&&!a&&r.willAppear(d,r),e===o?t.appendChild(d):t.insertBefore(d,t.childNodes[e]),[0].includes(r._$nodeType)&&!a&&r.didAppear(d,r),e++,o++},!1),V(s),[e,o]}function M(s,e){return K(s._$nodes,e)}function g(s){return K(s,void 0)}function K(s,e){let t=0,n=!1;return w(s,o=>n?!1:o===e?(n=!0,!1):[1,0].includes(o._$nodeType)?(t++,!1):!0),t}function m(s,e){w(s,t=>([2,6].includes(t._$nodeType)&&t[e](t),!0))}function J(s){m(s,"willMount")}function V(s){m(s,"didMount")}function Y(s){m(s,"willUnmount")}function Q(s){m(s,"didUnmount")}var c=class extends I{constructor(e){super(0);i(this,"_$envNodes",[]);this._$el=document.createElement(e)}_$init(){this._$bindNodes(),C(this,this._$nodes)}_$addNodes(e){this._$nodes=e}_$addProp(e,t,n,o){let d;if(e[0]==="_"?d=l=>this._$el.style[e.slice(1)]=l:e==="innerText"?d=l=>this._$el.innerText=l:e==="innerHTML"?d=l=>this._$el.innerHTML=l:d=l=>this._$el[e]=l,!o){d(t);return}let r=t();d(r);let a=()=>{let l=t();r!==l&&(d(l),r=l)},$={};this._$depObjectIds.push($),n._$addDeps(o,$,a)}willAppear(e,t){}didAppear(e,t){}willDisappear(e,t){}didDisappear(e,t){}_$addLifeCycle(e,t){let n=this[t];this[t]=function(o,d,...r){return n.call(this,o,d),e.call(this,o,d)}}},X=class extends I{afterUpdateNewNodes(s){}addAfterUpdateNewNodesFunc(s){let e=this.afterUpdateNewNodes;this.afterUpdateNewNodes=function(t){s.call(this,t),e.call(this,t)}}onUpdateNodes(s,e){}addOnUpdateNodesFunc(s){let e=this.onUpdateNodes;this.onUpdateNodes=function(t,n){s.call(this,t,n),e.call(this,t,n)}}_$bindNewNodes(s){v(s,this),this._$beforeInitSubNodes(),x(s),this.afterUpdateNewNodes(s)}},Z=class extends X{constructor(){super(3);i(this,"keys",[]);i(this,"array",[]);i(this,"_$nodess",[]);i(this,"nodeFunc");i(this,"keyFunc");i(this,"arrayFunc");i(this,"dlScope");i(this,"listenDeps");i(this,"_$envNodes",[]);i(this,"duplicatedOrNoKey",!1)}_$getItem(e,t){let n=this.duplicatedOrNoKey?t:this.keys.indexOf(e);return this.array[n]}_$addNodeFunc(e){this.nodeFunc=e}_$addKeyFunc(e){this.keyFunc=e}_$addArrayFunc(e,t,n){this.dlScope=e,this.arrayFunc=t,this.listenDeps=n}_$addNodess(e){this._$nodess=e,this._$nodes=this._$nodess.flat(1)}setArray(){this.array=[...this.arrayFunc()]}setKeys(){if(!this.keyFunc){this.duplicatedOrNoKey=!0;return}let e=[...this.keyFunc()];if(e.length===[...new Set(e)].length){this.keys=e;return}this.keys=[...Array(this.array.length).keys()],console.warn("重复key了"),this.duplicatedOrNoKey=!0}_$init(){if(!this.listenDeps){this._$bindNodes();return}let e=this._$parentNode;for(;e&&e._$nodeType!==0;)e=e._$parentNode;if(!e)return;let t=this.keyFunc?()=>this.updateWithKey(e):()=>this.updateWithOutKey(e),n={};if(this._$depObjectIds.push(n),this.dlScope._$addDeps(this.listenDeps,n,t),this.setArray(),this.setKeys(),this.duplicatedOrNoKey)for(let o of this.array.keys())this._$nodess.push(this.nodeFunc(null,o,this));else for(let[o,d]of this.keys.entries())this._$nodess.push(this.nodeFunc(d,o,this));this._$nodes=this._$nodess.flat(1),this._$bindNodes()}getNewNodes(e,t){let n=this.nodeFunc(e,t,this);return this._$bindNewNodes(n),n}updateWithOutKey(e){let t=e._$el,n=this.array.length;this.setArray();let o=this.array.length;if(n!==o){if(n<o){let d=M(e,this),r=t.childNodes.length;for(let a=0;a<o;a++){if(a<n){d+=g(this._$nodess[a]);continue}let $=this.getNewNodes(null,a);[d,r]=P($,d,t,r),this._$nodess.push($)}this._$nodes=this._$nodess.flat(1);return}for(let d=o;d<n;d++)T(this._$nodess[d],this.dlScope),F(this._$nodess[d]);this._$nodess=this._$nodess.slice(0,o),this._$nodes=this._$nodess.flat(1)}}async updateWithKey(e){let t=e._$el,n=M(e,this),o=this.keys,d=[...this.array],r=[...this._$nodess],a=[...this._$nodes];this.setArray(),this.setKeys(),this.duplicatedOrNoKey&&(o=[...Array(d.length).keys()]);let $=[],l=[];for(let[h,f]of o.entries()){if(this.keys.includes(f)){$.push(f),l.push(r[h]);continue}T(r[h],this.dlScope),F(r[h])}o=$;let _=n,u=t.childNodes.length;for(let[h,f]of this.keys.entries()){if(o.includes(f)){_+=g(l[o.indexOf(f)]);continue}let p=this.getNewNodes(f,h);[_,u]=P(p,_,t,u),l.splice(h,0,p),o.splice(h,0,f)}_=n;for(let[h,f]of this.keys.entries()){let p=o.indexOf(f);if(p===h){_+=g(l[h]);continue}let b=l[p],U=o[p];[_,u]=P(b,_,t,u),l.splice(p,1),o.splice(p,1),l.splice(h+1,0,b),o.splice(h+1,0,U)}this._$nodess=l,this._$nodes=this._$nodess.flat(1),this.onUpdateNodes(a,this._$nodes)}_$listen(e,t,n,o){let d={};e._$depObjectIds.push(d),e._$addDeps(n,d,()=>{let r=t();if(r===void 0){e._$deleteDeps(d);return}o(r)})}},A=G;function ee(s,e){new e().render(s)}let te=1;const O=["pretty","large","big","small","tall","short","long","handsome","plain","quaint","clean","elegant","easy","angry","crazy","helpful","mushy","odd","unsightly","adorable","important","inexpensive","cheap","expensive","fancy"],R=["red","yellow","blue","green","pink","brown","purple","brown","white","black","orange"],B=["table","chair","house","bbq","desk","car","pony","cookie","sandwich","burger","pizza","mouse","keyboard"];function k(s){return Math.round(Math.random()*1e3)%s}function D(s){let e=new Array(s);for(let t=0;t<s;t++)e[t]={id:te++,label:`${O[k(O.length)]} ${R[k(R.length)]} ${B[k(B.length)]}`};return e}class y extends A{constructor(){super(...arguments);i(this,"_$deps",{id:new Map,onclick:new Map,_$content:new Map});i(this,"_$tag","Button");i(this,"_$$id","_$prop");i(this,"id");i(this,"_$$onclick","_$prop");i(this,"onclick");i(this,"_$$_$content","_$prop");i(this,"_$content");i(this,"Body",()=>{const t=new c("div");return t._$addProp("className","col-sm-6 smallpad"),t._$addNodes((()=>{const n=new c("button");return n._$addProp("innerText",()=>this._$content,this,["_$content"]),n._$addProp("onclick",()=>this.onclick,this,["onclick"]),n._$addProp("id",()=>this.id,this,["id"]),n._$addProp("className","btn btn-primary btn-block"),[n]})()),[t]})}}class se extends A{constructor(){super(...arguments);i(this,"_$deps",{id:new Map,label:new Map,className:new Map,selectRow:new Map,deleteRow:new Map});i(this,"_$tag","Row");i(this,"_$$id","_$prop");i(this,"id");i(this,"_$$label","_$prop");i(this,"label");i(this,"_$$className","_$prop");i(this,"className");i(this,"_$$selectRow","_$prop");i(this,"selectRow");i(this,"_$$deleteRow","_$prop");i(this,"deleteRow");i(this,"Body",()=>{const t=new c("tr");return t._$addProp("className",()=>this.className,this,["className"]),t._$addNodes((()=>{const n=new c("td");n._$addProp("innerText",()=>this.id,this,["id"]),n._$addProp("className","col-md-1");const o=new c("td");o._$addProp("innerText",()=>this.label,this,["label"]),o._$addProp("className","col-md-4"),o._$addProp("onclick",()=>this.selectRow(this.id));const d=new c("td");d._$addProp("className","col-md-1"),d._$addProp("onclick",()=>this.deleteRow(this.id)),d._$addNodes((()=>{const a=new c("a");return a._$addProp("className","remove"),a._$addNodes((()=>{const $=new c("span");return $._$addProp("className","remove glyphicon glyphicon-remove"),$._$addProp("ariaHidden",!0),[$]})()),[a]})());const r=new c("td");return r._$addProp("innerText",""),r._$addProp("className","col-md-6"),[n,o,d,r]})()),[t]})}}class ne extends A{constructor(){super(...arguments);i(this,"_$deps",{rows:new Map,selectIdx:new Map,count:new Map});i(this,"_$tag","Benchmark");i(this,"_$$rows",[]);i(this,"_$$selectIdx",-1);i(this,"addRows",()=>{this.rows=D(1e3)});i(this,"swapRows",()=>{this.rows.length>999&&(this.rows=[this.rows[0],this.rows[998],...this.rows.slice(2,998),this.rows[1],this.rows[999]])});i(this,"clearRows",()=>{this.rows=[]});i(this,"selectRow",t=>{this.selectIdx=t});i(this,"deleteRow",t=>{const n=this.rows.findIndex(o=>o.id===t);this.rows=[...this.rows.slice(0,n),...this.rows.slice(n+1)]});i(this,"addBig",()=>{this.rows=D(1e4)});i(this,"append",()=>{this.rows=[...this.rows,...D(1e3)]});i(this,"update",()=>{for(let t=0;t<this.rows.length;t+=10)this.rows[t].label+="!!! ";this.rows=[...this.rows]});i(this,"_$$count",-1);i(this,"Body",()=>{const t=new c("div");t._$addProp("className","col-sm-6"),t._$addNodes((()=>{const d=new c("h1");return d._$addProp("innerText","dlight"),[d]})());const n=new c("div");n._$addProp("className","row"),n._$addNodes((()=>{const d=new c("div");return d._$addProp("className","col-sm-6"),d._$addNodes((()=>{const r=new y;r._$addProp("_$content","Create 1,000 rows"),r._$addProp("onclick",this.addRows),r._$addProp("id","run");const a=new y;a._$addProp("_$content","Create 10,000 rows"),a._$addProp("onclick",this.addBig),a._$addProp("id","runlots");const $=new y;$._$addProp("_$content","Append 1,000 rows"),$._$addProp("onclick",this.append),$._$addProp("id","add");const l=new y;l._$addProp("_$content","Update every 10th rows"),l._$addProp("onclick",this.update),l._$addProp("id","update");const _=new y;_._$addProp("_$content","Clear"),_._$addProp("onclick",this.clearRows),_._$addProp("id","clear"),_._$addProp("className","col-sm-6 smallpad");const u=new y;return u._$addProp("_$content","Swap Rows"),u._$addProp("onclick",this.swapRows),u._$addProp("id","swaprows"),[r,a,$,l,_,u]})()),[d]})());const o=new c("div");return o._$addNodes((()=>{const d=new c("table");d._$addProp("className","table table-hover table-striped test-data"),d._$addNodes((()=>{const a=new c("tbody");return a._$addProp("id","tbody"),a._$addNodes((()=>{const $=new Z,l=$;return l._$addNodeFunc((_,u)=>{const{id:h,label:f}=l._$getItem(_,u);l._$listen(this,()=>l._$getItem(_,u),["rows"],b=>{});const p=new se;return p._$addProp("id",()=>h,this,["rows"],!1),p._$addProp("label",()=>f,this,["rows"],!1),p._$addProp("deleteRow",this.deleteRow),p._$addProp("selectRow",this.selectRow),p._$addProp("className",()=>this.selectIdx===h?"danger":"",this,["selectIdx","rows"],!1),[p]}),$._$addArrayFunc(this,()=>this.rows,["rows"]),[$]})()),[a]})());const r=new c("span");return r._$addProp("className","preloadicon glyphicon glyphicon-remove"),r._$addProp("ariaHidden","true"),[d,r]})()),[t,n,o]})}get rows(){return this._$$rows}set rows(t){this._$$rows!==t&&(this._$$rows=t,this._$runDeps("rows"))}get selectIdx(){return this._$$selectIdx}set selectIdx(t){this._$$selectIdx!==t&&(this._$$selectIdx=t,this._$runDeps("selectIdx"))}get count(){return this._$$count}set count(t){this._$$count!==t&&(this._$$count=t,this._$runDeps("count"))}}ee("app",ne);
