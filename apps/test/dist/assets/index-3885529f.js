var E=Object.defineProperty;var q=(n,s,e)=>s in n?E(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e;var r=(n,s,e)=>(q(n,typeof s!="symbol"?s+"":s,e),e);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();function k(n){for(let s of n){if(Array.isArray(s)){k(s);continue}s._$init()}}function L(n,s){for(let e of n){if(Array.isArray(e)){L(e,s);continue}e._$parentNode=s}}function N(n,s){for(let e of n)s(e)&&N(e._$nodes,s)}function x(n,s,e=!0){for(let t of n)[l.HTML,l.Text].includes(t._$nodeType)?(s(t._$el,t),e&&x(t._$nodes,s)):x(t._$nodes,s,e)}function z(n){const s=[];return x(n,(e,t)=>{t._$nodeType===l.HTML&&s.push(e)},!1),s}var l=(n=>(n[n.HTML=0]="HTML",n[n.Text=1]="Text",n[n.Custom=2]="Custom",n[n.For=3]="For",n[n.If=4]="If",n[n.Env=5]="Env",n[n.Expression=6]="Expression",n))(l||{});class O{constructor(s){r(this,"_$nodeType");r(this,"__$el");r(this,"_$parentNode");r(this,"_$nodes",[]);r(this,"_$depObjectIds",[]);this._$nodeType=s}get _$el(){return this.__$el??z(this._$nodes)}set _$el(s){this.__$el=s}_$beforeInitSubNodes(){}_$addBeforeInitSubNodes(s){const e=this._$beforeInitSubNodes;this._$beforeInitSubNodes=function(){e.call(this),s.call(this)}}_$bindNodes(){L(this._$nodes,this),this._$beforeInitSubNodes(),k(this._$nodes)}_$init(){}}function G(n,s,e,t,i,o,d){if(e in n){if(!o){n[e]=t;return}if(!(n[`_$$${e}`]!==`_$${s}`||!(`_$$${e}`in n))){if(n[`_$$${e}`]===`_$${s}`){J(i,n,e,t,o);return}if(d&&`_$$${o[0]}`in i){Q(i,n,e,t,o);return}X(i,n,e,t,o)}}}function J(n,s,e,t,i){const o={};s._$depObjectIds.push(o),s[e]=t(),n._$addDeps(i,o,()=>{s[e]=t(),s._$runDeps(e)})}function Q(n,s,e,t,i){const o={};s._$depObjectIds.push(o);for(let d of i){const a=()=>n[d]=s[e];s._$addDeps([e],o,a),s[e]=t(),n._$addDeps(i,o,()=>{s._$deleteDep(e,o),s[e]=t(),s._$addDeps([e],o,a)})}}function X(n,s,e,t,i){const o={};s._$depObjectIds.push(o),s[`_$${e}`]=t(),n._$addDeps(i,o,()=>{s[`_$${e}`]=t(),s._$runDeps(e)})}class Y extends O{constructor(){super(l.Custom);r(this,"_$deps",{});r(this,"_$envNodes");r(this,"_$derivedPairs");r(this,"_$tag","");r(this,"Body",()=>[]);r(this,"_$childrenFunc");r(this,"_$_children")}_$addAfterset(e){const t=this.Preset;this.Preset=()=>{t(),e()}}_$runDeps(e){if(this._$deps[e]===void 0){console.warn(`${e} is not a dependency in ${this.constructor.name}`);return}for(let t of this._$deps[e].values())t.call(this)}get _$children(){return this._$childrenFunc?(this._$_children||(this._$_children=this._$childrenFunc.map(e=>e())),this._$_children):[]}_$addChildren(e){this._$childrenFunc=e}_$initDecorators(){if(this._$derivedPairs)for(let[e,t]of Object.entries(this._$derivedPairs)){const i=this[e];if(typeof i!="function")return;this[e]=this[e]();let o=this[e];this._$addDeps(t,{},()=>{const d=i();d!==o&&(this[e]=d,o=d,this._$runDeps(e))})}}_$addDeps(e,t,i){for(let o of e)this._$deps[o].set(t,i)}_$deleteDep(e,t){this._$deps[e].delete(t)}_$deleteDeps(e){for(let t in this._$deps)this._$deleteDep(t,e)}AfterConstruct(){}Preset(){}Afterset(){}_$init(){this.AfterConstruct(),this._$initDecorators(),this.Preset(),this._$nodes=this.Body(),this.Afterset(),this._$bindNodes()}_$addProp(e,t,i,o,d){G(this,"prop",e,t,i,o,d)}willMount(e,t){}didMount(e,t){}willUnmount(e,t){}didUnmount(e,t){}_$addLifeCycle(e,t){const i=this[t];this[t]=function(o,d){e.call(this,this._$el,this),i.call(this,this._$el,this)}}render(e){const t=new _("div");t._$addNodes([this]),t._$addProp("id",typeof e=="string"?e:e.id),t._$init(),this.willMount(this._$el,this),N(this._$nodes,i=>{switch(i._$nodeType){case l.HTML:i.willAppear(i._$el,i);break;case l.Custom:i.willMount(i._$el,i);break}return!0}),typeof e=="string"&&(e=document.getElementById(e)),e.replaceWith(t._$el),N(this._$nodes,i=>{switch(i._$nodeType){case l.HTML:i.didAppear(i._$el,i);break;case l.Custom:i.didMount(i._$el,i);break}return!0}),this.didMount(this._$el,this)}}function S(n,s){N(s,e=>{switch(e._$nodeType){case l.Text:case l.HTML:n._$el.appendChild(e._$el);break;default:S(n,e._$nodes);break}return!1})}function H(n){te(n),x(n,(s,e)=>{document.body.contains(s)&&(e._$nodeType===l.HTML&&e.willDisappear(s,e),s.remove(),e._$nodeType===l.HTML&&e.didDisappear(s,e))}),se(n)}function C(n,s){N(n,e=>{for(let t of e._$depObjectIds)s._$deleteDeps(t);return!0})}function D(n,s,e,t){let i=t??e.childNodes.length;return Z(n),x(n,(o,d)=>{const a=document.body.contains(o);[l.HTML].includes(d._$nodeType)&&!a&&d.willAppear(o,d),s===i?e.appendChild(o):e.insertBefore(o,e.childNodes[s]),[l.HTML].includes(d._$nodeType)&&!a&&d.didAppear(o,d),s++,i++},!1),ee(n),[s,i]}function U(n,s){return W(n._$nodes,s)}function T(n){return W(n,void 0)}function W(n,s){let e=0,t=!1;return N(n,i=>t?!1:i===s?(t=!0,!1):[l.Text,l.HTML].includes(i._$nodeType)?(e++,!1):!0),e}function v(n,s){N(n,e=>([l.Custom,l.Expression].includes(e._$nodeType)&&e[s](e),!0))}function Z(n){v(n,"willMount")}function ee(n){v(n,"didMount")}function te(n){v(n,"willUnmount")}function se(n){v(n,"didUnmount")}class _ extends O{constructor(e){super(l.HTML);r(this,"_$envNodes",[]);this._$el=document.createElement(e)}_$init(){this._$bindNodes(),S(this,this._$nodes)}_$addNodes(e){this._$nodes=e}_$addProp(e,t,i,o){let d;if(e[0]==="_"?d=c=>this._$el.style[e.slice(1)]=c:e==="innerText"?d=c=>this._$el.innerText=c:e==="innerHTML"?d=c=>this._$el.innerHTML=c:d=c=>this._$el[e]=c,!o){d(t);return}let a=t();d(a);const h=()=>{const c=t();a!==c&&(d(c),a=c)},u={};this._$depObjectIds.push(u),i._$addDeps(o,u,h)}willAppear(e,t){}didAppear(e,t){}willDisappear(e,t){}didDisappear(e,t){}_$addLifeCycle(e,t){const i=this[t];this[t]=function(o,d,...a){return i.call(this,o,d),e.call(this,o,d)}}}class ne extends O{afterUpdateNewNodes(s){}addAfterUpdateNewNodesFunc(s){const e=this.afterUpdateNewNodes;this.afterUpdateNewNodes=function(t){s.call(this,t),e.call(this,t)}}onUpdateNodes(s,e){}addOnUpdateNodesFunc(s){const e=this.onUpdateNodes;this.onUpdateNodes=function(t,i){s.call(this,t,i),e.call(this,t,i)}}_$bindNewNodes(s){L(s,this),this._$beforeInitSubNodes(),k(s),this.afterUpdateNewNodes(s)}}class ie extends ne{constructor(){super(l.For);r(this,"keys",[]);r(this,"array",[]);r(this,"_$nodess",[]);r(this,"nodeFunc");r(this,"keyFunc");r(this,"arrayFunc");r(this,"dlScope");r(this,"listenDeps");r(this,"_$envNodes",[]);r(this,"duplicatedOrNoKey",!1)}_$getItem(e,t){let i=this.duplicatedOrNoKey?t:this.keys.indexOf(e);return this.array[i]}_$addNodeFunc(e){this.nodeFunc=e}_$addKeyFunc(e){this.keyFunc=e}_$addArrayFunc(e,t,i){this.dlScope=e,this.arrayFunc=t,this.listenDeps=i}_$addNodess(e){this._$nodess=e,this._$nodes=this._$nodess.flat(1)}setArray(){this.array=[...this.arrayFunc()]}setKeys(){if(!this.keyFunc){this.duplicatedOrNoKey=!0;return}const e=[...this.keyFunc()];if(e.length===[...new Set(e)].length){this.keys=e;return}this.keys=[...Array(this.array.length).keys()],console.warn("重复key了"),this.duplicatedOrNoKey=!0}_$init(){if(!this.listenDeps){this._$bindNodes();return}let e=this._$parentNode;for(;e&&e._$nodeType!==l.HTML;)e=e._$parentNode;if(!e)return;const t=this.keyFunc?()=>this.updateWithKey(e):()=>this.updateWithOutKey(e),i={};if(this._$depObjectIds.push(i),this.dlScope._$addDeps(this.listenDeps,i,t),this.setArray(),this.setKeys(),this.duplicatedOrNoKey)for(let o of this.array.keys())this._$nodess.push(this.nodeFunc(null,o,this));else for(let[o,d]of this.keys.entries())this._$nodess.push(this.nodeFunc(d,o,this));this._$nodes=this._$nodess.flat(1),this._$bindNodes()}getNewNodes(e,t){const i=this.nodeFunc(e,t,this);return this._$bindNewNodes(i),i}updateWithOutKey(e){const t=e._$el,i=this.array.length;this.setArray();const o=this.array.length;if(i!==o){if(i<o){let d=U(e,this),a=t.childNodes.length;for(let h=0;h<o;h++){if(h<i){d+=T(this._$nodess[h]);continue}const u=this.getNewNodes(null,h);[d,a]=D(u,d,t,a),this._$nodess.push(u)}this._$nodes=this._$nodess.flat(1);return}for(let d=o;d<i;d++)C(this._$nodess[d],this.dlScope),H(this._$nodess[d]);this._$nodess=this._$nodess.slice(0,o),this._$nodes=this._$nodess.flat(1)}}async updateWithKey(e){const t=e._$el,i=U(e,this);let o=this.keys;const d=[...this.array],a=[...this._$nodess],h=[...this._$nodes];this.setArray(),this.setKeys(),this.duplicatedOrNoKey&&(o=[...Array(d.length).keys()]);let u=[];const c=[];for(let[f,$]of o.entries()){if(this.keys.includes($)){u.push($),c.push(a[f]);continue}C(a[f],this.dlScope),H(a[f])}o=u;let p=i,g=t.childNodes.length;for(let[f,$]of this.keys.entries()){if(o.includes($)){p+=T(c[o.indexOf($)]);continue}const w=this.getNewNodes($,f);[p,g]=D(w,p,t,g),c.splice(f,0,w),o.splice(f,0,$)}p=i;for(let[f,$]of this.keys.entries()){const w=o.indexOf($);if(w===f){p+=T(c[f]);continue}const y=c[w],m=o[w];[p,g]=D(y,p,t,g),c.splice(w,1),o.splice(w,1),c.splice(f+1,0,y),o.splice(f+1,0,m)}this._$nodess=c,this._$nodes=this._$nodess.flat(1),this.onUpdateNodes(h,this._$nodes)}_$listen(e,t,i,o){const d={};e._$depObjectIds.push(d),e._$addDeps(i,d,()=>{const a=t();if(a===void 0){e._$deleteDeps(d);return}o(a)})}}const V=Y;function oe(n,s){new s().render(n)}let de=1;const j=["pretty","large","big","small","tall","short","long","handsome","plain","quaint","clean","elegant","easy","angry","crazy","helpful","mushy","odd","unsightly","adorable","important","inexpensive","cheap","expensive","fancy"],B=["red","yellow","blue","green","pink","brown","purple","brown","white","black","orange"],R=["table","chair","house","bbq","desk","car","pony","cookie","sandwich","burger","pizza","mouse","keyboard"];function A(n){return Math.round(Math.random()*1e3)%n}function F(n){let s=new Array(n);for(let e=0;e<n;e++)s[e]={id:de++,label:`${j[A(j.length)]} ${B[A(B.length)]} ${R[A(R.length)]}`};return s}class I extends V{constructor(){super(...arguments);r(this,"_$deps",{id:new Map,onclick:new Map,_$content:new Map});r(this,"_$tag","Button");r(this,"_$$id","_$prop");r(this,"id");r(this,"_$$onclick","_$prop");r(this,"onclick");r(this,"_$$_$content","_$prop");r(this,"_$content");r(this,"Body",()=>{const e=new _("div");return e._$addProp("className","col-sm-6 smallpad"),e._$addNodes((()=>{const t=new _("button");return t._$addProp("innerText",()=>this._$content,this,["_$content"]),t._$addProp("onclick",()=>this.onclick,this,["onclick"]),t._$addProp("id",()=>this.id,this,["id"]),t._$addProp("className","btn btn-primary btn-block"),[t]})()),[e]})}}class re extends V{constructor(){super(...arguments);r(this,"_$deps",{rows:new Map,selectIdx:new Map,count:new Map});r(this,"_$tag","Benchmark");r(this,"_$$rows",[]);r(this,"_$$selectIdx",-1);r(this,"addRows",()=>{this.rows=F(1e3)});r(this,"swapRows",()=>{this.rows.length>999&&(this.rows=[this.rows[0],this.rows[998],...this.rows.slice(2,998),this.rows[1],this.rows[999]])});r(this,"clearRows",()=>{this.rows=[]});r(this,"selectRow",e=>{this.selectIdx=e});r(this,"deleteRow",e=>{const t=this.rows.findIndex(i=>i.id===e);this.rows=[...this.rows.slice(0,t),...this.rows.slice(t+1)]});r(this,"addBig",()=>{this.rows=F(1e4)});r(this,"append",()=>{this.rows=[...this.rows,...F(1e3)]});r(this,"update",()=>{for(let e=0;e<this.rows.length;e+=10)this.rows[e].label+="!!! ";this.rows=[...this.rows]});r(this,"_$$count",-1);r(this,"Body",()=>{const e=new _("div");e._$addProp("className","col-sm-6"),e._$addNodes((()=>{const o=new _("h1");return o._$addProp("innerText","dlight"),[o]})());const t=new _("div");t._$addProp("className","row"),t._$addNodes((()=>{const o=new _("div");return o._$addProp("className","col-sm-6"),o._$addNodes((()=>{const d=new I;d._$addProp("_$content","Create 1,000 rows"),d._$addProp("onclick",this.addRows),d._$addProp("id","run");const a=new I;a._$addProp("_$content","Create 10,000 rows"),a._$addProp("onclick",this.addBig),a._$addProp("id","runlots");const h=new I;h._$addProp("_$content","Append 1,000 rows"),h._$addProp("onclick",this.append),h._$addProp("id","add");const u=new I;u._$addProp("_$content","Update every 10th rows"),u._$addProp("onclick",this.update),u._$addProp("id","update");const c=new I;c._$addProp("_$content","Clear"),c._$addProp("onclick",this.clearRows),c._$addProp("id","clear"),c._$addProp("className","col-sm-6 smallpad");const p=new I;return p._$addProp("_$content","Swap Rows"),p._$addProp("onclick",this.swapRows),p._$addProp("id","swaprows"),[d,a,h,u,c,p]})()),[o]})());const i=new _("div");return i._$addNodes((()=>{const o=new _("table");o._$addProp("className","table table-hover table-striped test-data"),o._$addNodes((()=>{const a=new _("tbody");return a._$addProp("id","tbody"),a._$addNodes((()=>{const h=new ie,u=h;return u._$addNodeFunc((c,p)=>{const{id:g,label:f}=u._$getItem(c,p),$={};$.id=g,$.label=f,u._$listen(this,()=>u._$getItem(c,p),["rows"],y=>{const{id:m,label:P}=y;$.id=m,$.label=P});const w=new _("tr");return w._$addProp("data_id",()=>$.id,this,["rows"]),w._$addProp("className",()=>this.selectIdx===$.id?"danger":"",this,["selectIdx","rows"]),w._$addNodes((()=>{const y=new _("td");y._$addProp("innerText",()=>$.id,this,["rows"]),y._$addProp("className","col-md-1");const m=new _("td");m._$addProp("className","col-md-4"),m._$addProp("onclick",()=>this.selectRow($.id)),m._$addNodes((()=>{const b=new _("a");return b._$addProp("innerText",()=>$.label,this,["rows"]),b._$addProp("className","lbl"),[b]})());const P=new _("td");P._$addProp("className","col-md-1"),P._$addProp("onclick",()=>this.deleteRow($.id)),P._$addNodes((()=>{const b=new _("a");return b._$addProp("className","remove"),b._$addNodes((()=>{const M=new _("span");return M._$addProp("className","remove glyphicon glyphicon-remove"),M._$addProp("ariaHidden",!0),[M]})()),[b]})());const K=new _("td");return K._$addProp("className","col-md-6"),[y,m,P,K]})()),[w]}),h._$addArrayFunc(this,()=>this.rows,["rows"]),[h]})()),[a]})());const d=new _("span");return d._$addProp("className","preloadicon glyphicon glyphicon-remove"),d._$addProp("ariaHidden","true"),[o,d]})()),[e,t,i]})}get rows(){return this._$$rows}set rows(e){this._$$rows!==e&&(this._$$rows=e,this._$runDeps("rows"))}get selectIdx(){return this._$$selectIdx}set selectIdx(e){this._$$selectIdx!==e&&(this._$$selectIdx=e,this._$runDeps("selectIdx"))}get count(){return this._$$count}set count(e){this._$$count!==e&&(this._$$count=e,this._$runDeps("count"))}}oe("app",re);
