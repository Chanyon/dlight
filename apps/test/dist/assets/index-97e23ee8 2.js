var S=Object.defineProperty;var W=(o,s,e)=>s in o?S(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e;var r=(o,s,e)=>(W(o,typeof s!="symbol"?s+"":s,e),e);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();function T(o){for(let s of o){if(Array.isArray(s)){T(s);continue}s._$init()}}function A(o,s){for(let e of o){if(Array.isArray(e)){A(e,s);continue}e._$parentNode=s}}function y(o,s){for(let e of o)s(e)&&y(e._$nodes,s)}function N(o,s,e=!0){for(let t of o)[$.HTML,$.Text].includes(t._$nodeType)?(s(t._$el,t),e&&N(t._$nodes,s)):N(t._$nodes,s,e)}function V(o){const s=[];return N(o,(e,t)=>{t._$nodeType===$.HTML&&s.push(e)},!1),s}var $=(o=>(o[o.HTML=0]="HTML",o[o.Text=1]="Text",o[o.Custom=2]="Custom",o[o.For=3]="For",o[o.If=4]="If",o[o.Env=5]="Env",o[o.Expression=6]="Expression",o))($||{});class F{constructor(s){r(this,"_$nodeType");r(this,"__$el");r(this,"_$parentNode");r(this,"_$nodes",[]);r(this,"_$depObjectIds",[]);this._$nodeType=s}get _$el(){return this.__$el??V(this._$nodes)}set _$el(s){this.__$el=s}_$beforeInitSubNodes(){}_$addBeforeInitSubNodes(s){const e=this._$beforeInitSubNodes;this._$beforeInitSubNodes=function(){e.call(this),s.call(this)}}_$bindNodes(){A(this._$nodes,this),this._$beforeInitSubNodes(),T(this._$nodes)}_$init(){}}function E(o,s,e,t,n,i,d){if(e in o){if(!i){o[e]=t;return}if(!(o[`_$$${e}`]!==`_$${s}`||!(`_$$${e}`in o))){if(o[`_$$${e}`]===`_$${s}`){q(n,o,e,t,i);return}if(d&&`_$$${i[0]}`in n){z(n,o,e,t,i);return}G(n,o,e,t,i)}}}function q(o,s,e,t,n){const i={};s._$depObjectIds.push(i),s[e]=t(),o._$addDeps(n,i,()=>{s[e]=t(),s._$runDeps(e)})}function z(o,s,e,t,n){const i={};s._$depObjectIds.push(i);for(let d of n){const a=()=>o[d]=s[e];s._$addDeps([e],i,a),s[e]=t(),o._$addDeps(n,i,()=>{s._$deleteDep(e,i),s[e]=t(),s._$addDeps([e],i,a)})}}function G(o,s,e,t,n){const i={};s._$depObjectIds.push(i),s[`_$${e}`]=t(),o._$addDeps(n,i,()=>{s[`_$${e}`]=t(),s._$runDeps(e)})}class J extends F{constructor(){super($.Custom);r(this,"_$deps",{});r(this,"_$envNodes");r(this,"_$derivedPairs");r(this,"_$tag","");r(this,"Body",()=>[]);r(this,"_$childrenFunc");r(this,"_$_children")}_$addAfterset(e){const t=this.Preset;this.Preset=()=>{t(),e()}}_$runDeps(e){if(this._$deps[e]===void 0){console.warn(`${e} is not a dependency in ${this.constructor.name}`);return}for(let t of this._$deps[e].values())t.call(this)}get _$children(){return this._$childrenFunc?(this._$_children||(this._$_children=this._$childrenFunc.map(e=>e())),this._$_children):[]}_$addChildren(e){this._$childrenFunc=e}_$initDecorators(){if(this._$derivedPairs)for(let[e,t]of Object.entries(this._$derivedPairs)){const n=this[e];if(typeof n!="function")return;this[e]=this[e]();let i=this[e];this._$addDeps(t,{},()=>{const d=n();d!==i&&(this[e]=d,i=d,this._$runDeps(e))})}}_$addDeps(e,t,n){for(let i of e)this._$deps[i].set(t,n)}_$deleteDep(e,t){this._$deps[e].delete(t)}_$deleteDeps(e){for(let t in this._$deps)this._$deleteDep(t,e)}AfterConstruct(){}Preset(){}Afterset(){}_$init(){this.AfterConstruct(),this._$initDecorators(),this.Preset(),this._$nodes=this.Body(),this.Afterset(),this._$bindNodes()}_$addProp(e,t,n,i,d){E(this,"prop",e,t,n,i,d)}willMount(e,t){}didMount(e,t){}willUnmount(e,t){}didUnmount(e,t){}_$addLifeCycle(e,t){const n=this[t];this[t]=function(i,d){e.call(this,this._$el,this),n.call(this,this._$el,this)}}render(e){const t=new _("div");t._$addNodes([this]),t._$addProp("id",typeof e=="string"?e:e.id),t._$init(),this.willMount(this._$el,this),y(this._$nodes,n=>{switch(n._$nodeType){case $.HTML:n.willAppear(n._$el,n);break;case $.Custom:n.willMount(n._$el,n);break}return!0}),typeof e=="string"&&(e=document.getElementById(e)),e.replaceWith(t._$el),y(this._$nodes,n=>{switch(n._$nodeType){case $.HTML:n.didAppear(n._$el,n);break;case $.Custom:n.didMount(n._$el,n);break}return!0}),this.didMount(this._$el,this)}}function U(o,s){y(s,e=>{switch(e._$nodeType){case $.Text:case $.HTML:o._$el.appendChild(e._$el);break;default:U(o,e._$nodes);break}return!1})}function L(o){Y(o),N(o,(s,e)=>{document.body.contains(s)&&(e._$nodeType===$.HTML&&e.willDisappear(s,e),s.remove(),e._$nodeType===$.HTML&&e.didDisappear(s,e))}),Z(o)}function R(o,s){y(o,e=>{for(let t of e._$depObjectIds)s._$deleteDeps(t);return!0})}function x(o,s,e,t){let n=t??e.childNodes.length;return Q(o),N(o,(i,d)=>{const a=document.body.contains(i);[$.HTML].includes(d._$nodeType)&&!a&&d.willAppear(i,d),s===n?e.appendChild(i):e.insertBefore(i,e.childNodes[s]),[$.HTML].includes(d._$nodeType)&&!a&&d.didAppear(i,d),s++,n++},!1),X(o),[s,n]}function O(o,s){return j(o._$nodes,s)}function M(o){return j(o,void 0)}function j(o,s){let e=0,t=!1;return y(o,n=>t?!1:n===s?(t=!0,!1):[$.Text,$.HTML].includes(n._$nodeType)?(e++,!1):!0),e}function g(o,s){y(o,e=>([$.Custom,$.Expression].includes(e._$nodeType)&&e[s](e),!0))}function Q(o){g(o,"willMount")}function X(o){g(o,"didMount")}function Y(o){g(o,"willUnmount")}function Z(o){g(o,"didUnmount")}class _ extends F{constructor(e){super($.HTML);r(this,"_$envNodes",[]);this._$el=document.createElement(e)}_$init(){this._$bindNodes(),U(this,this._$nodes)}_$addNodes(e){this._$nodes=e}_$addProp(e,t,n,i){let d;if(e[0]==="_"?d=l=>this._$el.style[e.slice(1)]=l:e==="innerText"?d=l=>this._$el.innerText=l:e==="innerHTML"?d=l=>this._$el.innerHTML=l:d=l=>this._$el[e]=l,!i){d(t);return}let a=t();d(a);const c=()=>{const l=t();a!==l&&(d(l),a=l)},h={};this._$depObjectIds.push(h),n._$addDeps(i,h,c)}willAppear(e,t){}didAppear(e,t){}willDisappear(e,t){}didDisappear(e,t){}_$addLifeCycle(e,t){const n=this[t];this[t]=function(i,d,...a){return n.call(this,i,d),e.call(this,i,d)}}}class ee extends F{afterUpdateNewNodes(s){}addAfterUpdateNewNodesFunc(s){const e=this.afterUpdateNewNodes;this.afterUpdateNewNodes=function(t){s.call(this,t),e.call(this,t)}}onUpdateNodes(s,e){}addOnUpdateNodesFunc(s){const e=this.onUpdateNodes;this.onUpdateNodes=function(t,n){s.call(this,t,n),e.call(this,t,n)}}_$bindNewNodes(s){A(s,this),this._$beforeInitSubNodes(),T(s),this.afterUpdateNewNodes(s)}}class te extends ee{constructor(){super($.For);r(this,"keys",[]);r(this,"array",[]);r(this,"_$nodess",[]);r(this,"nodeFunc");r(this,"keyFunc");r(this,"arrayFunc");r(this,"dlScope");r(this,"listenDeps");r(this,"_$envNodes",[]);r(this,"duplicatedOrNoKey",!1)}_$getItem(e,t){let n=this.duplicatedOrNoKey?t:this.keys.indexOf(e);return this.array[n]}_$addNodeFunc(e){this.nodeFunc=e}_$addKeyFunc(e){this.keyFunc=e}_$addArrayFunc(e,t,n){this.dlScope=e,this.arrayFunc=t,this.listenDeps=n}_$addNodess(e){this._$nodess=e,this._$nodes=this._$nodess.flat(1)}setArray(){this.array=[...this.arrayFunc()]}setKeys(){if(!this.keyFunc){this.duplicatedOrNoKey=!0;return}const e=[...this.keyFunc()];if(e.length===[...new Set(e)].length){this.keys=e;return}this.keys=[...Array(this.array.length).keys()],console.warn("重复key了"),this.duplicatedOrNoKey=!0}_$init(){if(!this.listenDeps){this._$bindNodes();return}let e=this._$parentNode;for(;e&&e._$nodeType!==$.HTML;)e=e._$parentNode;if(!e)return;const t=this.keyFunc?()=>this.updateWithKey(e):()=>this.updateWithOutKey(e),n={};if(this._$depObjectIds.push(n),this.dlScope._$addDeps(this.listenDeps,n,t),this.setArray(),this.setKeys(),this.duplicatedOrNoKey)for(let i of this.array.keys())this._$nodess.push(this.nodeFunc(null,i,this));else for(let[i,d]of this.keys.entries())this._$nodess.push(this.nodeFunc(d,i,this));this._$nodes=this._$nodess.flat(1),this._$bindNodes()}getNewNodes(e,t){const n=this.nodeFunc(e,t,this);return this._$bindNewNodes(n),n}updateWithOutKey(e){const t=e._$el,n=this.array.length;this.setArray();const i=this.array.length;if(n!==i){if(n<i){let d=O(e,this),a=t.childNodes.length;for(let c=0;c<i;c++){if(c<n){d+=M(this._$nodess[c]);continue}const h=this.getNewNodes(null,c);[d,a]=x(h,d,t,a),this._$nodess.push(h)}this._$nodes=this._$nodess.flat(1);return}for(let d=i;d<n;d++)R(this._$nodess[d],this.dlScope),L(this._$nodess[d]);this._$nodess=this._$nodess.slice(0,i),this._$nodes=this._$nodess.flat(1)}}async updateWithKey(e){const t=e._$el,n=O(e,this);let i=this.keys;const d=[...this.array],a=[...this._$nodess],c=[...this._$nodes];this.setArray(),this.setKeys(),this.duplicatedOrNoKey&&(i=[...Array(d.length).keys()]);let h=[];const l=[];for(let[w,p]of i.entries()){if(this.keys.includes(p)){h.push(p),l.push(a[w]);continue}R(a[w],this.dlScope),L(a[w])}i=h;let u=n,m=t.childNodes.length;for(let[w,p]of this.keys.entries()){if(i.includes(p)){u+=M(l[i.indexOf(p)]);continue}const f=this.getNewNodes(p,w);[u,m]=x(f,u,t,m),l.splice(w,0,f),i.splice(w,0,p)}u=n;for(let[w,p]of this.keys.entries()){const f=i.indexOf(p);if(f===w){u+=M(l[w]);continue}const P=l[f],I=i[f];[u,m]=x(P,u,t,m),l.splice(f,1),i.splice(f,1),l.splice(w+1,0,P),i.splice(w+1,0,I)}this._$nodess=l,this._$nodes=this._$nodess.flat(1),this.onUpdateNodes(c,this._$nodes)}_$listen(e,t,n,i){const d={};e._$depObjectIds.push(d),e._$addDeps(n,d,()=>{const a=t();if(a===void 0){e._$deleteDeps(d);return}i(a)})}}const k=J;function se(o,s){new s().render(o)}let ne=1;const K=["pretty","large","big","small","tall","short","long","handsome","plain","quaint","clean","elegant","easy","angry","crazy","helpful","mushy","odd","unsightly","adorable","important","inexpensive","cheap","expensive","fancy"],H=["red","yellow","blue","green","pink","brown","purple","brown","white","black","orange"],C=["table","chair","house","bbq","desk","car","pony","cookie","sandwich","burger","pizza","mouse","keyboard"];function v(o){return Math.round(Math.random()*1e3)%o}function D(o){let s=new Array(o);for(let e=0;e<o;e++)s[e]={id:ne++,label:`${K[v(K.length)]} ${H[v(H.length)]} ${C[v(C.length)]}`};return s}class b extends k{constructor(){super(...arguments);r(this,"_$deps",{id:new Map,onclick:new Map,_$content:new Map});r(this,"_$tag","Button");r(this,"_$$id","_$prop");r(this,"id");r(this,"_$$onclick","_$prop");r(this,"onclick");r(this,"_$$_$content","_$prop");r(this,"_$content");r(this,"Body",()=>{const e=new _("div");return e._$addProp("className","col-sm-6 smallpad"),e._$addNodes((()=>{const t=new _("button");return t._$addProp("innerText",()=>this._$content,this,["_$content"]),t._$addProp("onclick",()=>this.onclick,this,["onclick"]),t._$addProp("id",()=>this.id,this,["id"]),t._$addProp("className","btn btn-primary btn-block"),[t]})()),[e]})}}class oe extends k{constructor(){super(...arguments);r(this,"_$deps",{id:new Map,label:new Map,className:new Map,selectRow:new Map,deleteRow:new Map});r(this,"_$tag","Row");r(this,"_$$id","_$prop");r(this,"id");r(this,"_$$label","_$prop");r(this,"label");r(this,"_$$className","_$prop");r(this,"className");r(this,"_$$selectRow","_$prop");r(this,"selectRow");r(this,"_$$deleteRow","_$prop");r(this,"deleteRow");r(this,"Body",()=>{const e=new _("tr");return e._$addProp("data_id",()=>this.id,this,["id"]),e._$addProp("className",()=>this.className,this,["className"]),e._$addNodes((()=>{const t=new _("td");t._$addProp("innerText",()=>this.id,this,["id"]),t._$addProp("className","col-md-1");const n=new _("td");n._$addProp("className","col-md-4"),n._$addProp("onclick",()=>this.selectRow(this.id)),n._$addNodes((()=>{const a=new _("a");return a._$addProp("innerText",()=>this.label,this,["label"]),a._$addProp("className","lbl"),[a]})());const i=new _("td");i._$addProp("className","col-md-1"),i._$addProp("onclick",()=>this.deleteRow(this.id)),i._$addNodes((()=>{const a=new _("a");return a._$addProp("className","remove"),a._$addNodes((()=>{const c=new _("span");return c._$addProp("className","remove glyphicon glyphicon-remove"),c._$addProp("ariaHidden",!0),[c]})()),[a]})());const d=new _("td");return d._$addProp("className","col-md-6"),[t,n,i,d]})()),[e]})}}class ie extends k{constructor(){super(...arguments);r(this,"_$deps",{rows:new Map,selectIdx:new Map,count:new Map});r(this,"_$tag","Benchmark");r(this,"_$$rows",[]);r(this,"_$$selectIdx",-1);r(this,"addRows",()=>{this.rows=D(1e3)});r(this,"swapRows",()=>{this.rows.length>999&&(this.rows=[this.rows[0],this.rows[998],...this.rows.slice(2,998),this.rows[1],this.rows[999]])});r(this,"clearRows",()=>{this.rows=[]});r(this,"selectRow",e=>{this.selectIdx=e});r(this,"deleteRow",e=>{const t=this.rows.findIndex(n=>n.id===e);this.rows=[...this.rows.slice(0,t),...this.rows.slice(t+1)]});r(this,"addBig",()=>{this.rows=D(1e4)});r(this,"append",()=>{this.rows=[...this.rows,...D(1e3)]});r(this,"update",()=>{for(let e=0;e<this.rows.length;e+=10)this.rows[e].label+="!!! ";this.rows=[...this.rows]});r(this,"_$$count",-1);r(this,"Body",()=>{const e=new _("div");e._$addProp("className","col-sm-6"),e._$addNodes((()=>{const i=new _("h1");return i._$addProp("innerText","dlight"),[i]})());const t=new _("div");t._$addProp("className","row"),t._$addNodes((()=>{const i=new _("div");return i._$addProp("className","col-sm-6"),i._$addNodes((()=>{const d=new b;d._$addProp("_$content","Create 1,000 rows"),d._$addProp("onclick",this.addRows),d._$addProp("id","run");const a=new b;a._$addProp("_$content","Create 10,000 rows"),a._$addProp("onclick",this.addBig),a._$addProp("id","runlots");const c=new b;c._$addProp("_$content","Append 1,000 rows"),c._$addProp("onclick",this.append),c._$addProp("id","add");const h=new b;h._$addProp("_$content","Update every 10th rows"),h._$addProp("onclick",this.update),h._$addProp("id","update");const l=new b;l._$addProp("_$content","Clear"),l._$addProp("onclick",this.clearRows),l._$addProp("id","clear"),l._$addProp("className","col-sm-6 smallpad");const u=new b;return u._$addProp("_$content","Swap Rows"),u._$addProp("onclick",this.swapRows),u._$addProp("id","swaprows"),[d,a,c,h,l,u]})()),[i]})());const n=new _("div");return n._$addNodes((()=>{const i=new _("table");i._$addProp("className","table table-hover table-striped test-data"),i._$addNodes((()=>{const a=new _("tbody");return a._$addProp("id","tbody"),a._$addNodes((()=>{const c=new te,h=c;return h._$addNodeFunc((l,u)=>{const{id:m,label:w}=h._$getItem(l,u),p={};p.id=m,p.label=w,h._$listen(this,()=>h._$getItem(l,u),["rows"],P=>{const{id:I,label:B}=P;p.id=I,p.label=B});const f=new oe;return f._$addProp("id",()=>p.id,this,["rows"],!1),f._$addProp("label",()=>p.label,this,["rows"],!1),f._$addProp("deleteRow",this.deleteRow),f._$addProp("selectRow",this.selectRow),f._$addProp("className",()=>this.selectIdx===p.id?"danger":"",this,["selectIdx","rows"],!1),[f]}),c._$addArrayFunc(this,()=>this.rows,["rows"]),[c]})()),[a]})());const d=new _("span");return d._$addProp("className","preloadicon glyphicon glyphicon-remove"),d._$addProp("ariaHidden","true"),[i,d]})()),[e,t,n]})}get rows(){return this._$$rows}set rows(e){this._$$rows!==e&&(this._$$rows=e,this._$runDeps("rows"))}get selectIdx(){return this._$$selectIdx}set selectIdx(e){this._$$selectIdx!==e&&(this._$$selectIdx=e,this._$runDeps("selectIdx"))}get count(){return this._$$count}set count(e){this._$$count!==e&&(this._$$count=e,this._$runDeps("count"))}}se("app",ie);
